<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Removed restrictive CSP to allow Gemini API calls in this environment -->
    <title>Sushruta - AI Health Assistant</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Virtual Keyboard -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/css/index.min.css">
    <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/index.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base styles for all devices */
        html, body {
            height: 100%;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent; /* Disable tap highlight on mobile */
        }
        body {
            font-family: 'Inter', 'Noto Sans Devangari', sans-serif;
            background: linear-gradient(135deg, #F9A825 0%, #F57F17 50%, #E65100 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px; 
        }
        
        .chat-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #F9A825 0%, #F57F17 50%, #E65100 100%);
            background-size: 200% 200%; /* For gradient animation */
            animation: gradient-animation 15s ease infinite; /* Added animation */
            color: white;
            padding: 1rem 1.5rem 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            flex-shrink: 0;
        }
        
        @keyframes gradient-animation { /* Keyframes for gradient animation */
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .logo-container {
            position: relative;
            z-index: 10;
        }

        .header-content-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            width: 100%;
            max-width: 280px;
            margin: 0.75rem auto 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 1rem;
            padding: 0.75rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        
        .lang-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .lang-btn {
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .lang-btn:hover, .lang-btn.active {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }
        
        .disclaimer-banner {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            color: white;
            text-align: center;
            font-size: 0.8rem;
            padding: 0.75rem 1rem;
            font-weight: 600;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .disclaimer-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s infinite;
        }
        
        .quick-actions {
            padding: 0.75rem;
            background: #f8fffe;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            border-bottom: 2px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 20;
            flex-shrink: 0;
        }
        
        .quick-btn {
            padding: 0.5rem 0.75rem;
            border-radius: 1rem;
            background: white;
            border: 2px solid #e5e7eb;
            color: #374151;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            flex-shrink: 0;
        }
        
        .quick-btn .icon {
            font-size: 1.25rem;
        }
        
        .quick-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(249, 168, 37, 0.2);
            border-color: #F9A825;
            color: #F9A825;
        }
        
        .quick-btn.emergency, .quick-btn.women, .quick-btn.mental-health, .quick-btn.nearby {
            color: white;
        }
        
        .quick-btn.emergency {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-color: #dc2626;
        }
        
        .quick-btn.emergency:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
        }
        
        .quick-btn.women {
            background: linear-gradient(135deg, #ec4899, #db2777);
            border-color: #db2777;
        }
        
        .quick-btn.women:hover {
            background: linear-gradient(135deg, #db2777, #be185d);
            box-shadow: 0 8px 20px rgba(219, 39, 119, 0.4);
        }

        .quick-btn.mental-health {
            background: linear-gradient(135deg, #38bdf8, #0ea5e9);
            border-color: #0ea5e9;
        }
        
        .quick-btn.mental-health:hover {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.4);
        }

        .quick-btn.nearby {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            border-color: #4f46e5;
        }

        .quick-btn.nearby:hover {
            background: linear-gradient(135deg, #4f46e5, #4338ca);
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.4);
        }

        .disease-alert {
            padding: 1rem 2.5rem 1rem 1rem;
            margin: 0 1.5rem;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 2px solid #93c5fd;
            border-radius: 1rem;
            position: relative;
            top: -1rem;
            z-index: 15;
            box-shadow: 0 8px 20px rgba(191, 219, 254, 0.5);
            transition: all 0.5s ease-in-out;
        }

        .alert-close-btn {
            position: absolute;
            top: 50%;
            right: 0.5rem;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: #1e3a8a;
            font-size: 1.75rem;
            line-height: 1;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .alert-close-btn:hover {
            background-color: rgba(30, 64, 175, 0.1);
        }

        .alert-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
        }

        .alert-content p {
            margin-bottom: 0.5rem;
            color: #1e40af;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .alert-content strong {
            font-weight: 600;
            color: #1c3d8a;
        }

        .chat-area {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: linear-gradient(180deg, #fefffe 0%, #f9fffe 100%);
            position: relative;
            transition: padding-bottom 0.4s ease; /* For keyboard */
        }

        .chat-area-with-keyboard {
            padding-bottom: 280px; /* Adjust based on keyboard height */
        }
        
        .chat-area::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-area::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-area::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #F9A825, #F57F17);
            border-radius: 4px;
        }
        
        .message {
            margin-bottom: 1.5rem;
            animation: messageSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
            line-height: 1.6;
        }
        
        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .user-message, .bot-message {
            max-width: 85%;
            padding: 1rem 1.25rem;
        }

        .user-message {
            background: linear-gradient(135deg, #F9A825 0%, #F57F17 100%);
            color: white;
            margin-left: auto;
            border-radius: 1.5rem 1.5rem 0.5rem 1.5rem;
            box-shadow: 0 4px 16px rgba(249, 168, 37, 0.3);
        }
        
        .bot-message {
            background: white;
            color: #1f2937;
            border: 2px solid #e5e7eb;
            border-radius: 1.5rem 1.5rem 1.5rem 0.5rem;
            position: relative;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
        }
        
        .bot-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #F9A825, #F57F17);
            border-radius: 3px 0 0 3px;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            width: fit-content;
            margin-bottom: 1.5rem;
            border: 2px solid #e5e7eb;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F9A825, #F57F17);
            animation: typingBounce 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0.32s; }
        
        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .input-area {
            background: #f8fffe;
            padding: 1rem 1rem;
            border-top: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            flex-shrink: 0;
        }
        
        .voice-btn, .send-btn, .keyboard-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }

        .keyboard-btn {
             background: linear-gradient(135deg, #60a5fa, #3b82f6);
             color: white;
        }

        .keyboard-btn.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .voice-btn {
            background: linear-gradient(135deg, #fbbf24, #f97316);
            color: white;
        }
        
        .voice-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 24px rgba(251, 191, 36, 0.4);
        }
        
        .voice-btn.listening {
            animation: voicePulse 1.5s infinite;
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        @keyframes voicePulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3); }
            50% { transform: scale(1.1); box-shadow: 0 8px 30px rgba(239, 68, 68, 0.5); }
        }
        
        .message-input {
            flex: 1;
            padding: 0.8rem 1.25rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 1.75rem;
            font-size: 16px; /* Prevents iOS zoom */
            transition: all 0.3s ease;
            outline: none;
            font-weight: 500;
        }
        
        .message-input:focus {
            border-color: #F9A825;
            box-shadow: 0 0 0 4px rgba(249, 168, 37, 0.1);
        }
        
        .send-btn {
            background: linear-gradient(135deg, #F9A825, #F57F17);
            color: white;
        }
        
        .send-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 24px rgba(249, 168, 37, 0.4);
        }
        
        .send-btn:active {
            transform: translateY(0) scale(0.95);
        }
        
        .help-section {
            background: linear-gradient(135deg, #ebf4ff, #dbeafe);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 2px solid #bfdbfe;
        }
        
        .help-title {
            color: #1e3a8a;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .help-list {
            color: #1e3a8a;
            font-weight: 500;
            line-height: 1.7;
        }

        .voice-tooltip {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .voice-tooltip.hidden {
            opacity: 0;
            transform: translateY(5px);
            pointer-events: none;
        }
        
        /* Focus indicators for keyboard navigation */
        *:focus {
            outline: 3px solid #F9A825;
            outline-offset: 2px;
        }
        
        .lang-btn:focus {
            outline-color: white;
        }

        /* Collapsible section styles */
        .collapsible {
            max-height: 500px;
            transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out, padding 0.5s, margin 0.5s;
            overflow: hidden;
        }

        .collapsed {
            max-height: 0;
            opacity: 0;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
            border-width: 0 !important;
        }

        #header-toggle-icon.rotate-180 {
            transform: rotate(180deg);
        }

        /* --- Virtual Keyboard Styles --- */
        .keyboard-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #e5e7eb;
            z-index: 100;
            transform: translateY(100%);
            transition: transform 0.4s ease-in-out;
            padding: 0.5rem;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
        }

        .keyboard-container.visible {
            transform: translateY(0);
        }

        .simple-keyboard {
            border-radius: 0.5rem;
        }

        .simple-keyboard.hg-theme-default {
            background-color: transparent;
            border: none;
        }

        .simple-keyboard.hg-theme-default .hg-button {
            background: white;
            border-bottom: 2px solid #d1d5db;
            color: #1f2937;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: background 0.2s ease, transform 0.1s ease;
        }
        .simple-keyboard.hg-theme-default .hg-button:active {
            transform: scale(0.95);
        }

        .simple-keyboard.hg-theme-default .hg-button.hg-function {
            background: #d1d5db;
        }

        /* Responsive Design */
        @media (min-width: 640px) {
            body {
                padding: 1.5rem;
            }
            .chat-container {
                max-width: 42rem;
                height: 90vh;
                max-height: 850px;
                border-radius: 1.5rem;
                box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.3);
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
            .input-area {
                padding: 1rem 1.5rem;
                gap: 1rem;
            }
            .voice-btn, .send-btn, .keyboard-btn {
                width: 52px;
                height: 52px;
            }
            .message-input {
                padding: 1rem 1.5rem;
            }
        }

        @media (min-width: 1024px) {
            .chat-container {
                max-width: 48rem;
            }
            .message-input {
                font-size: 1.1rem;
            }
        }
        
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Medical Disclaimer Banner -->
        <div class="disclaimer-banner" id="disclaimer-banner">
            <!-- Text will be inserted by script -->
        </div>

        <!-- Header -->
        <header class="header">
            
            <div class="header-content-wrapper">
                <!-- Icon removed from here -->
                <div class="logo-container">
                    <div class="lang-selector">
                        <button class="lang-btn active" onclick="setLanguage('hi')" id="lang-hi">हिंदी</button>
                        <button class="lang-btn" onclick="setLanguage('en')" id="lang-en">English</button>
                        <button class="lang-btn" onclick="setLanguage('bn')" id="lang-bn">বাংলা</button>
                        <button class="lang-btn" onclick="setLanguage('ta')" id="lang-ta">தமிழ்</button>
                        <button class="lang-btn" onclick="setLanguage('od')" id="lang-od">ଓଡ଼ିଆ</button>
                        <button class="lang-btn" onclick="setLanguage('te')" id="lang-te">తెలుగు</button>
                    </div>
                    <div class="flex items-center justify-center gap-3">
                        <svg class="w-7 h-7" viewBox="0 0 448 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M64 0C46.3 0 32 14.3 32 32V224H0V384H32v96c0 17.7 14.3 32 32 32H352c17.7 0 32-14.3 32-32V384H416V224H384V32c0-17.7-14.3-32-32-32H64zM208 288h-32c-8.8 0-16-7.2-16-16s7.2-16 16-16h32V224c0-8.8 7.2-16 16-16s16 7.2 16 16v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v32c0 8.8-7.2 16-16 16s-16-7.2-16-16V288z"/>
                        </svg>
                        <h1 id="main-title" class="text-2xl font-bold tracking-tight" style="font-family: 'Inter', sans-serif;"></h1>
                        <svg class="w-7 h-7" viewBox="0 0 448 512" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path d="M64 0C46.3 0 32 14.3 32 32V224H0V384H32v96c0 17.7 14.3 32 32 32H352c17.7 0 32-14.3 32-32V384H416V224H384V32c0-17.7-14.3-32-32-32H64zM208 288h-32c-8.8 0-16-7.2-16-16s7.2-16 16-16h32V224c0-8.8 7.2-16 16-16s16 7.2 16 16v32h32c8.8 0 16 7.2 16 16s-7.2 16-16 16h-32v32c0 8.8-7.2 16-16 16s-16-7.2-16-16V288z"/>
                        </svg>
                    </div>
                    <p id="sub-title" class="text-base text-orange-100 font-semibold mt-1"></p>
                    <div class="stats-grid">
                        <!-- Removed the old stats grid items -->
                    </div>
                </div>
            </div>
            
            <button id="header-toggle-btn" class="absolute bottom-[-1rem] bg-white text-gray-600 rounded-full p-1 shadow-md border-2 border-gray-200 transition-transform duration-300 z-10">
                <svg id="header-toggle-icon" class="w-6 h-6 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
            </button>
        </header>

        <!-- Disease Alert Section -->
        <div id="disease-alert" class="disease-alert collapsible">
            <div class="alert-header">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 24px; height: 24px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h3 id="disease-alert-title" class="font-bold"></h3>
            </div>
            <div id="disease-alert-content" class="alert-content">
                <!-- Content will be inserted by script -->
            </div>
            <button id="close-alert-btn" title="Dismiss Alert" class="alert-close-btn">&times;</button>
        </div>

        <!-- Quick Actions -->
        <div id="quick-actions" class="quick-actions collapsible">
            <button id="quick-btn-fever" class="quick-btn"></button>
            <button id="quick-btn-cough" class="quick-btn"></button>
            <button id="quick-btn-vaccine" class="quick-btn"></button>
            <button id="quick-btn-stomach" class="quick-btn"></button>
            <button id="quick-btn-diet" class="quick-btn"></button>
            <button id="quick-btn-mental-health" class="quick-btn mental-health"></button>
            <button id="quick-btn-women" class="quick-btn women"></button>
            <button id="quick-btn-nearby" class="quick-btn nearby"></button>
            <button id="quick-btn-emergency" class="quick-btn emergency"></button>
        </div>

        <!-- Chat Area -->
        <main id="chatArea" class="chat-area">
            <div id="initialMessageContainer">
                    <!-- content from script -->
            </div>
            
            <!-- Enhanced Typing Indicator -->
            <div id="typingIndicator" class="typing-indicator" style="display: none;">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span id="typing-text" class="ml-2 text-base text-gray-700 font-semibold"></span>
            </div>
        </main>
        
        <!-- Enhanced Input Area -->
        <footer class="input-area">
            <!-- Voice Tooltip -->
            <div id="voice-tooltip" class="voice-tooltip hidden" style="position: absolute; bottom: 100%; left: 0; background: #1f2937; color: white; padding: 0.75rem 1rem; border-radius: 0.75rem; font-size: 0.8rem; white-space: nowrap; z-index: 30; transform: translateY(-10px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);">
                <span id="tooltip-text"></span>
                <button id="close-tooltip" class="ml-2 font-bold text-lg">&times;</button>
            </div>
            
            <button id="keyboardBtn" class="keyboard-btn" title="Toggle Keyboard">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="7" y1="7" x2="7" y2="7"></line><line x1="12" y1="7" x2="12" y2="7"></line><line x1="17" y1="7" x2="17" y2="7"></line>
                    <line x1="7" y1="12" x2="7" y2="12"></line><line x1="12" y1="12" x2="12" y2="12"></line><line x1="17" y1="12" x2="17" y2="12"></line>
                    <line x1="7" y1="17" x2="12" y2="17"></line>
                </svg>
            </button>

            <!-- Voice Button -->
            <button id="voiceBtn" class="voice-btn" title="Voice Input">
                <svg id="mic-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 1C10.89 1 10 1.89 10 3V12C10 13.11 10.89 14 12 14C13.11 14 14 13.11 14 12V3C14 1.89 13.11 1 12 1Z" fill="currentColor"/>
                    <path d="M19 10V12C19 15.87 15.87 19 12 19C8.13 19 5 15.87 5 12V10H7V12C7 14.76 9.24 17 12 17C14.76 17 17 14.76 17 12V10H19Z" fill="currentColor"/>
                    <path d="M12 19V23H8V21H16V23H12V19Z" fill="currentColor"/>
                </svg>
            </button>
            
            <input type="text" id="messageInput" class="message-input">
            
            <button id="sendBtn" class="send-btn" title="Send Message">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2.01 21L23 12L2.01 3L2 10L17 12L2 14L2.01 21Z" fill="currentColor"/>
                </svg>
            </button>
        </footer>
    </div>
    
    <!-- Virtual Keyboard Container -->
    <div id="keyboard-container" class="keyboard-container">
        <div class="simple-keyboard"></div>
    </div>
    
    <script>
        // Sushruta - AI Health Assistant - Main JavaScript
        
        // --- IMPORTANT: For the app to work, you must replace this with your own Google AI API Key. ---
        // You can get a key from the Google AI Studio: https://makersuite.google.com/
        const apiKey = "AIzaSyDY4WUNKFyJmTDKZFCi0xZjLZvoMxsNTNo"; // If you want to use models other than gemini-2.5-flash-preview-05-20 or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
        
        const API_MODEL = "gemini-2.5-flash-preview-05-20";
        
        if (apiKey === "PASTE_YOUR_GOOGLE_AI_API_KEY_HERE") {
            const errorElement = document.createElement('div');
            errorElement.style.cssText = 'position:fixed;top:0;left:0;width:100%;padding:1rem;background:red;color:white;text-align:center;font-weight:bold;z-index:1000;';
            errorElement.textContent = 'API Key is missing! Please add your API key to the script section in index.html to enable the assistant.';
            document.body.appendChild(errorElement);
        }

        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${apiKey}`;

        // --- DOM Elements ---
        const chatArea = document.getElementById('chatArea');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const keyboardBtn = document.getElementById('keyboardBtn');
        const keyboardContainer = document.getElementById('keyboard-container');
        const typingIndicator = document.getElementById('typingIndicator');
        const initialMessageContainer = document.getElementById('initialMessageContainer');
        const voiceTooltip = document.getElementById('voice-tooltip');
        const closeTooltipBtn = document.getElementById('close-tooltip');
        const headerToggleBtn = document.getElementById('header-toggle-btn');
        const headerToggleIcon = document.getElementById('header-toggle-icon');
        const quickActions = document.getElementById('quick-actions');
        
        let currentLanguage = 'hi'; // Default language

        // --- Comprehensive Translations Object (Updated with localized alerts) ---
        const translations = {
            en: {
                disclaimer: "⚠️ Important: This is for assistance only. Consult a doctor for serious issues.",
                mainTitle: "Sushruta",
                subTitle: "Your Health Assistant",
                quickBtnFever: "Fever",
                quickBtnCough: "Cough",
                quickBtnVaccine: "Vaccine",
                quickBtnStomach: "Stomach",
                quickBtnDiet: "Diet Plan",
                quickBtnMentalHealth: "Mental Health",
                quickBtnWomen: "Women Health",
                quickBtnNearby: "Nearby Doctor",
                quickBtnEmergency: "Emergency",
                queryFever: "What are the symptoms of a fever?",
                queryCough: "How to treat a cough?",
                queryVaccine: "About child vaccinations",
                queryStomach: "Home remedies for stomach ache",
                queryDiet: "General advice for a healthy diet",
                queryMentalHealth: "How to improve mental well-being?",
                queryWomen: "Common women's health issues",
                queryEmergency: "I need emergency help",
                helpTitle: "<span>📚</span> How can I help you?",
                helpList: `• Know disease symptoms<br>• Get home remedies<br>• Learn about vaccination`,
                initialBotGreeting: "🙏 Hello! I'm Sushruta, your AI Health Assistant!",
                initialBotInstruction: "I can help with health issues. Use the buttons above or type your question.",
                typingText: "Sushruta is thinking...",
                inputPlaceholder: "Ask your question...",
                tooltipText: "🎤 Tap mic to speak",
                emergencyResponse: `🚨 **This sounds serious. Please seek immediate medical help.**<br><br>Call the National Emergency Number: <b>112</b><br>Or call for an Ambulance: <b>108</b>`,
                diseaseAlertTitle: "Health Alerts for Noida (Sept 2025)",
                diseaseAlertDengueTitle: "Dengue & Malaria Alert 🦟",
                diseaseAlertDengueInfo: "Post-monsoon season sees a rise in mosquito-borne illnesses. Prevent breeding by cleaning coolers and pots. Use repellents and sleep under a mosquito net.",
                diseaseAlertViralTitle: "Water-Borne Disease Warning 💧",
                diseaseAlertViralInfo: "Risk of Typhoid & Jaundice is high. Drink only boiled or filtered water, avoid street food, and wash hands frequently.",
                doctorDisclaimer: "Please note: This is a sample list based on publicly available data and may not be current or complete. Please contact the hospital directly to confirm doctor availability and book an appointment.",
                dietFormTitle: "Get a Personalized Diet Plan",
                dietFormSubtitle: "Please provide your details below:",
                ageLabel: "Your Age:",
                genderLabel: "Your Gender:",
                goalLabel: "Your Goal:",
                agePlaceholder: "Enter age",
                genderMale: "Male",
                genderFemale: "Female",
                goalLoose: "Lose Weight",
                goalGain: "Gain Weight",
                goalMaintain: "Maintain Weight",
                generateBtn: "Generate Plan",
                dietChartGenerating: "Generating your personalized diet chart...",
                chartGeneratedMessage: "Here is a sample diet chart based on your details. Remember to consult with a professional nutritionist or doctor for a plan tailored to your specific needs.",
                nearbyDoctorsGenerating: "Searching for nearby doctors...",
                locationPermissionDenied: "Location access denied. Please enable it in your browser settings to find nearby doctors."
            },
            hi: {
                disclaimer: "⚠️ महत्वपूर्ण: यह केवल सहायता के लिए है। गंभीर समस्या के लिए डॉक्टर से मिलें।",
                mainTitle: "सुश्रुत",
                subTitle: "आपका स्वास्थ्य सहायक",
                quickBtnFever: "बुखार",
                quickBtnCough: "खांसी",
                quickBtnVaccine: "टीका",
                quickBtnStomach: "पेट दर्द",
                quickBtnDiet: "आहार योजना",
                quickBtnMentalHealth: "मानसिक स्वास्थ्य",
                quickBtnWomen: "महिला स्वास्थ्य",
                quickBtnNearby: "निकटवर्ती डॉक्टर",
                quickBtnEmergency: "आपातकालीन",
                queryFever: "बुखार के लक्षण क्या हैं?",
                queryCough: "खांसी का इलाज कैसे करें?",
                queryVaccine: "बच्चों का टीकाकरण",
                queryStomach: "पेट दर्द का घरेलू इलाज",
                queryDiet: "स्वस्थ आहार के लिए सामान्य सलाह",
                queryMentalHealth: "मानसिक स्वास्थ्य कैसे सुधारें?",
                queryWomen: "महिलाओं की स्वास्थ्य समस्या",
                queryEmergency: "आपातकालीन मदद चाहिए",
                helpTitle: "<span>📚</span> मैं आपकी कैसे मदद कर सकता हूं?",
                helpList: `• बीमारी के लक्षण जानने के लिए<br>• घरेलू उपचार की जानकारी के लिए<br>• टीकाकरण की जानकारी के लिए`,
                initialBotGreeting: "🙏 नमस्ते! मैं सुश्रुत हूं, आपका AI स्वास्थ्य सहायक!",
                initialBotInstruction: "मैं आपकी स्वास्थ्य संबंधी समस्याओं में मदद कर सकता हूं। ऊपर के बटन दबाएं या अपना सवाल टाइप करें।",
                typingText: "सुश्रुत सोच रहा है...",
                inputPlaceholder: "अपना सवाल पूछें...",
                tooltipText: "🎤 माइक दबाकर बोलें",
                emergencyResponse: `🚨 **यह गंभीर लग रहा है। कृपया तत्काल चिकित्सा सहायता लें।**<br><br>राष्ट्रीय आपातकालीन नंबर पर कॉल करें: <b>112</b><br>या एम्बुलेंस के लिए कॉल करें: <b>108</b>`,
                diseaseAlertTitle: "नोएडा के लिए स्वास्थ्य अलर्ट (सितंबर 2025)",
                diseaseAlertDengueTitle: "डेंगू और मलेरिया अलर्ट 🦟",
                diseaseAlertDengueInfo: "मानसून के बाद मच्छर जनित बीमारियाँ बढ़ जाती हैं। कूलर और गमलों की सफाई करके मच्छरों को पनपने से रोकें। मच्छर भगाने वाली क्रीम का प्रयोग करें और मच्छरदानी लगाकर सोएं।",
                diseaseAlertViralTitle: "जल जनित रोग चेतावनी 💧",
                diseaseAlertViralInfo: "टाइफाइड और पीलिया का खतरा अधिक है। केवल उबला हुआ या फ़िल्टर किया हुआ पानी पिएं, बाहर के खाने से बचें और बार-बार हाथ धोएं।",
                doctorDisclaimer: "कृपया ध्यान दें: यह सार्वजनिक रूप से उपलब्ध डेटा पर आधारित एक नमूना सूची है और यह वर्तमान या पूर्ण नहीं हो सकती है। डॉक्टर की उपलब्धता की पुष्टि करने और अपॉइंटमेंट बुक करने के लिए कृपया सीधे अस्पताल से संपर्क करें।",
                dietFormTitle: "व्यक्तिगत आहार योजना प्राप्त करें",
                dietFormSubtitle: "कृपया नीचे अपना विवरण प्रदान करें:",
                ageLabel: "आपकी उम्र:",
                genderLabel: "आपका लिंग:",
                goalLabel: "आपका लक्ष्य:",
                agePlaceholder: "उम्र दर्ज करें",
                genderMale: "पुरुष",
                genderFemale: "महिला",
                goalLoose: "वजन घटाना",
                goalGain: "वजन बढ़ाना",
                goalMaintain: "वजन बनाए रखना",
                generateBtn: "योजना बनाएं",
                dietChartGenerating: "आपकी व्यक्तिगत आहार योजना बनाई जा रही है...",
                chartGeneratedMessage: "आपके विवरण के आधार पर एक नमूना आहार चार्ट यहां दिया गया है। अपनी विशिष्ट आवश्यकताओं के अनुसार योजना के लिए पेशेवर पोषण विशेषज्ञ या डॉक्टर से परामर्श करना याद रखें।",
                nearbyDoctorsGenerating: "निकटवर्ती डॉक्टरों की तलाश की जा रही है...",
                locationPermissionDenied: "स्थान तक पहुंच से इनकार किया गया। कृपया पास के डॉक्टरों को खोजने के लिए इसे अपने ब्राउज़र सेटिंग्स में सक्षम करें।"
            },
            bn: {
                disclaimer: "⚠️ গুরুত্বপূর্ণ: এটি শুধুমাত্র সহায়তার জন্য। গুরুতর সমস্যার জন্য ডাক্তারের সাথে পরামর্শ করুন।",
                mainTitle: "সুশ্রুত",
                subTitle: "আপনার স্বাস্থ্য সহকারী",
                quickBtnFever: "জ্বর",
                quickBtnCough: "কাশি",
                quickBtnVaccine: "টিকা",
                quickBtnStomach: "পেট ব্যথা",
                quickBtnDiet: "ডায়েট প্ল্যান",
                quickBtnMentalHealth: "মানসিক স্বাস্থ্য",
                quickBtnWomen: "মহিলাদের স্বাস্থ্য",
                quickBtnNearby: "কাছের ডাক্তার",
                quickBtnEmergency: "জরুরী",
                queryFever: "জ্বরের লক্ষণ কি?",
                queryCough: "কাশির চিকিৎসা কিভাবে করবেন?",
                queryVaccine: "শিশুদের টিকা সম্পর্কে",
                queryStomach: "পেট ব্যথার ঘরোয়া প্রতিকার",
                queryDiet: "স্বাস্থ্যকর খাবারের জন্য সাধারণ পরামর্শ",
                queryMentalHealth: "মানসিক সুস্থতা কীভাবে উন্নত করা যায়?",
                queryWomen: "মহিলাদের স্বাস্থ্য সমস্যা",
                queryEmergency: "জরুরী সাহায্য প্রয়োজন",
                helpTitle: "<span>📚</span> আমি কিভাবে আপনাকে সাহায্য করতে পারি?",
                helpList: `• রোগের লক্ষণ জানুন<br>• ঘরোয়া প্রতিকার পান<br>• টিকা সম্পর্কে জানুন`,
                initialBotGreeting: "🙏 নমস্কার! আমি সুশ্রুত, আপনার এআই স্বাস্থ্য সহকারী!",
                initialBotInstruction: "আমি স্বাস্থ্য সমস্যায় সাহায্য করতে পারি। উপরের বোতামগুলি ব্যবহার করুন বা আপনার প্রশ্ন টাইপ করুন।",
                typingText: "সুশ্রুত ভাবছে...",
                inputPlaceholder: "আপনার প্রশ্ন জিজ্ঞাসা করুন...",
                tooltipText: "🎤 কথা বলতে মাইক ট্যাপ করুন",
                emergencyResponse: `🚨 **এটি গুরুতর মনে হচ্ছে। অনুগ্রহ করে অবিলম্বে চিকিৎসা সহায়তা নিন।**<br><br>জাতীয় জরুরি নম্বর এ কল করুন: <b>112</b><br>অথবা অ্যাম্বুলেন্সের জন্য কল করুন: <b>108</b>`,
                diseaseAlertTitle: "নয়ডার জন্য স্বাস্থ্য সতর্কতা (সেপ্টেম্বর 2025)",
                diseaseAlertDengueTitle: "ডেঙ্গু ও ম্যালেরিয়া সতর্কতা 🦟",
                diseaseAlertDengueInfo: "বর্ষার পরে মশা বাহিত রোগের প্রকোপ বাড়ে। কুলার ও পাত্র পরিষ্কার করে মশার বংশবৃদ্ধি রোধ করুন। রিপেলেন্ট ব্যবহার করুন এবং মশারি টাঙিয়ে ঘুমান।",
                diseaseAlertViralTitle: "জলবাহিত রোগের সতর্কতা 💧",
                diseaseAlertViralInfo: "টাইফয়েড ও জন্ডিসের ঝুঁকি বেশি। শুধুমাত্র ফোটানো বা ফিল্টার করা জল পান করুন, রাস্তার খাবার এড়িয়ে চলুন এবং ঘন ঘন হাত ধুন।",
                doctorDisclaimer: "অনুগ্রহ করে মনে রাখবেন: এটি সর্বজনীনভাবে উপলব্ধ ডেটার উপর ভিত্তি করে একটি নমুনা তালিকা এবং এটি বর্তমান বা সম্পূর্ণ নাও হতে পারে। ডাক্তারের প্রাপ্যতা নিশ্চিত করতে এবং অ্যাপয়েন্টমেন্ট বুক করতে সরাসরি হাসপাতালের সাথে যোগাযোগ করুন।",
                dietFormTitle: "একটি ব্যক্তিগতকৃত ডায়েট প্ল্যান পান",
                dietFormSubtitle: "আপনার বিবরণ নিচে প্রদান করুন:",
                ageLabel: "আপনার বয়স:",
                genderLabel: "আপনার লিঙ্গ:",
                goalLabel: "আপনার লক্ষ্য:",
                agePlaceholder: "বয়স লিখুন",
                genderMale: "পুরুষ",
                genderFemale: "মহিলা",
                goalLoose: "ওজন কমানো",
                goalGain: "ওজন বাড়ানো",
                goalMaintain: "ওজন বজায় রাখা",
                generateBtn: "প্ল্যান তৈরি করুন",
                dietChartGenerating: "আপনার ব্যক্তিগতকৃত ডায়েট চার্ট তৈরি করা হচ্ছে...",
                chartGeneratedMessage: "আপনার তথ্যের উপর ভিত্তি করে একটি নমুনা ডায়েট চার্ট এখানে দেওয়া হল। আপনার নির্দিষ্ট প্রয়োজনের জন্য একটি প্ল্যান পেতে একজন পেশাদার পুষ্টিবিদ বা ডাক্তারের সাথে পরামর্শ করতে মনে রাখবেন।",
                nearbyDoctorsGenerating: "কাছের ডাক্তারদের খোঁজা হচ্ছে...",
                locationPermissionDenied: "অবস্থান অ্যাক্সেস অস্বীকার করা হয়েছে। কাছের ডাক্তারদের খুঁজে পেতে অনুগ্রহ করে আপনার ব্রাউজারের সেটিংসে এটি সক্ষম করুন।"
            },
            ta: {
                disclaimer: "⚠️ முக்கியம்: இது உதவிக்கு மட்டுமே. গুরুতর பிரச்சினைகளுக்கு மருத்துவரை அணுகவும்.",
                mainTitle: "சுஷ்ருதா",
                subTitle: "உங்கள் சுகாதார உதவியாளர்",
                quickBtnFever: "காய்ச்சல்",
                quickBtnCough: "இருமல்",
                quickBtnVaccine: "தடுப்பூசி",
                quickBtnStomach: "வயிற்று வலி",
                quickBtnDiet: "உணவு திட்டம்",
                quickBtnMentalHealth: "மனநலம்",
                quickBtnWomen: "பெண்கள் நலம்",
                quickBtnNearby: "அருகிலுள்ள மருத்துவர்",
                quickBtnEmergency: "அவசரம்",
                queryFever: "காய்ச்சலின் அறிகுறிகள் என்ன?",
                queryCough: "இருமல் குணப்படுத்துவது எப்படி?",
                queryVaccine: "குழந்தை தடுப்பூசிகள் பற்றி",
                queryStomach: "வயிற்று வலிக்கான வீட்டு வைத்தியம்",
                queryDiet: "ஆரோக்கியமான உணவுக்கான பொதுவான ஆலோசனை",
                queryMentalHealth: "மன நலத்தை எவ்வாறு மேம்படுத்துவது?",
                queryWomen: "பெண்களின் சுகாதார பிரச்சினைகள்",
                queryEmergency: "எனக்கு அவசர உதவி தேவை",
                helpTitle: "<span>📚</span> நான் உங்களுக்கு எப்படி உதவ முடியும்?",
                helpList: `• நோய் அறிகுறிகளை அறியுங்கள்<br>• வீட்டு வைத்தியம் பெறுங்கள்<br>• தடுப்பூசி பற்றி அறியுங்கள்`,
                initialBotGreeting: "🙏 வணக்கம்! நான் சுஷ்ருதா, உங்கள் AI சுகாதார உதவியாளர்!",
                initialBotInstruction: "சுகாதார பிரச்சினைகளுக்கு நான் உதவ முடியும்। மேலே உள்ள பொத்தான்களைப் பயன்படுத்தவும் அல்லது உங்கள் கேள்வியை தட்டச்சு செய்யவும்।",
                typingText: "சுஷ்ருதா யோசிக்கிறது...",
                inputPlaceholder: "உங்கள் கேள்வியைக் கேளுங்கள்...",
                tooltipText: "🎤 பேச மைக்கைத் தட்டவும்",
                emergencyResponse: `🚨 **இது தீவிரமாகத் தெரிகிறது. உடனடியாக மருத்துவ உதவியை நாடுங்கள்.**<br><br>தேசிய அவசர எண்ணை அழைக்கவும்: <b>112</b><br>அல்லது ஆம்புலன்ஸை அழைக்கவும்: <b>108</b>`,
                diseaseAlertTitle: "நோய்டாவிற்கான சுகாதார எச்சரிக்கைகள் (செப்டம்பர் 2025)",
                diseaseAlertDengueTitle: "டெங்கு மற்றும் மலேரியா எச்சரிக்கை 🦟",
                diseaseAlertDengueInfo: "பருவமழைக்குப் பிந்தைய காலத்தில் கொசுக்களால் பரவும் நோய்கள் அதிகரிக்கின்றன. கூலர்கள் மற்றும் பானைகளை சுத்தம் செய்வதன் மூலம் கொசுக்கள் பெருகுவதைத் தடுக்கவும். கொசு விரட்டிகளைப் பயன்படுத்துங்கள் மற்றும் கொசுவலைக்குள் உறங்குங்கள்.",
                diseaseAlertViralTitle: "நீரால் பரவும் நோய்கள் எச்சரிக்கை 💧",
                diseaseAlertViralInfo: "டைபாய்டு மற்றும் மஞ்சள் காமாலை ஏற்படும் அபாயம் அதிகம். கொதிக்கவைத்த அல்லது வடிகட்டிய நீரை மட்டுமே குடியுங்கள், தெரு உணவுகளைத் தவிர்க்கவும், அடிக்கடி கைகளைக் கழுவவும்.",
                doctorDisclaimer: "தயவுசெய்து கவனிக்கவும்: இது பொதுவில் கிடைக்கும் தரவுகளின் அடிப்படையில் ஒரு மாதிரிப் பட்டியல் மட்டுமே, மேலும் இது தற்போதைய அல்லது முழுமையானதாக இருக்காது. மருத்துவரின் கிடைப்புத்தன்மையை உறுதிப்படுத்தவும் மற்றும் அப்பாயிண்ட்மென்ட்டை முன்பதிவு செய்யவும் நேரடியாக மருத்துவமனையைத் தொடர்பு கொள்ளவும்.",
                dietFormTitle: "தனிப்பயனாக்கப்பட்ட உணவுத் திட்டத்தைப் பெறுங்கள்",
                dietFormSubtitle: "உங்கள் விவரங்களை கீழே வழங்கவும்:",
                ageLabel: "உங்கள் வயது:",
                genderLabel: "உங்கள் பாலினம்:",
                goalLabel: "உங்கள் இலக்கு:",
                agePlaceholder: "வயதை உள்ளிடவும்",
                genderMale: "ஆண்",
                genderFemale: "பெண்",
                goalLoose: "எடை குறைத்தல்",
                goalGain: "எடை அதிகரித்தல்",
                goalMaintain: "எடையை பராமரித்தல்",
                generateBtn: "திட்டத்தை உருவாக்குங்கள்",
                dietChartGenerating: "உங்கள் தனிப்பயனாக்கப்பட்ட உணவு விளக்கப்படம் உருவாக்கப்படுகிறது...",
                chartGeneratedMessage: "உங்கள் விவரங்களின் அடிப்படையில் ஒரு மாதிரி உணவு விளக்கப்படம் இங்கே உள்ளது. உங்கள் குறிப்பிட்ட தேவைகளுக்கு ஏற்ற திட்டத்திற்காக ஒரு தொழில்முறை ஊட்டச்சத்து நிபுணர் அல்லது மருத்துவரை அணுகுவதை நினைவில் கொள்ளுங்கள்.",
                nearbyDoctorsGenerating: "அருகிலுள்ள மருத்துவர்களைத் தேடுகிறது...",
                locationPermissionDenied: "இருப்பிட அணுகல் மறுக்கப்பட்டது. அருகிலுள்ள மருத்துவர்களைக் கண்டறிய உங்கள் உலாவி அமைப்புகளில் அதை இயக்கவும்."
            },
            od: {
                disclaimer: "⚠️ ଗୁରୁତ୍ୱପୂର୍ଣ୍ଣ: ଏହା କେବଳ ସହାୟତା ପାଇଁ। ଗମ୍ଭୀର ସମସ୍ୟା ପାଇଁ ଡାକ୍ତରଙ୍କ ସହିତ ପରାମର୍ଶ କରନ୍ତୁ।",
                mainTitle: "ସୁଶ୍ରୁତ",
                subTitle: "ଆପଣଙ୍କ ସ୍ୱାସ୍ଥ୍ୟ ସହାୟକ",
                quickBtnFever: "ଜ୍ୱର",
                quickBtnCough: "କାଶ",
                quickBtnVaccine: "ଟିକା",
                quickBtnStomach: "ପେଟ ବ୍ୟଥା",
                quickBtnDiet: "ଡାଏଟ୍ ପ୍ଲାନ୍",
                quickBtnMentalHealth: "ମାନସିକ ସ୍ୱାସ୍ଥ୍ୟ",
                quickBtnWomen: "ମହିଳା ସ୍ୱାସ୍ଥ୍ୟ",
                quickBtnNearby: "ନିକଟସ୍ଥ ଡାକ୍ତର",
                quickBtnEmergency: "ଜରୁରୀକାଳୀନ",
                queryFever: "ଜ୍ୱରର ଲକ୍ଷଣ କ'ଣ?",
                queryCough: "କାଶର ଚିକିତ୍ସା କିପରି କରିବେ?",
                queryVaccine: "ଶିଶୁ ଟୀକାକରଣ ବିଷୟରେ",
                queryStomach: "ପେଟ ବ୍ୟଥା ପାଇଁ ଘରୋଇ ଉପଚାର",
                queryDiet: "ଏକ ସୁସ୍ଥ ଖାଦ୍ୟ ପାଇଁ ସାଧାରଣ ପରାମର୍ଶ",
                queryMentalHealth: "ମାନସିକ ସୁସ୍ଥତା କିପରି ଉନ୍ନତ କରିବେ?",
                queryWomen: "ମହିଳାଙ୍କ ସ୍ୱାସ୍ଥ୍ୟ ସମସ୍ୟା",
                queryEmergency: "ମୋତେ ଜରୁରୀକାଳୀନ ସାହାଯ୍ୟ ଦରକାର",
                helpTitle: "<span>📚</span> ମୁଁ ଆପଣଙ୍କୁ କିପରି ସାହାଯ୍ୟ କରିପାରେ?",
                helpList: `• ରୋଗର ଲକ୍ଷଣ ଜାଣନ୍ତୁ<br>• ଘରୋଇ ଉପଚାର ପାଆନ୍ତୁ<br>• ଟୀକାକରଣ ବିଷୟରେ ଜାଣନ୍ତୁ`,
                initialBotGreeting: "🙏 ନମସ୍କାର! ମୁଁ ସୁଶ୍ରୁତ, ଆପଣଙ୍କ AI ସ୍ୱାସ୍ଥ୍ୟ ସହାୟକ!",
                initialBotInstruction: "ମୁଁ ସ୍ୱାସ୍ଥ୍ୟ ସମସ୍ୟାରେ ସାହାଯ୍ୟ କରିପାରିବି। ଉପର ବଟନ୍ ବ୍ୟବହାର କରନ୍ତୁ କିମ୍ବା ଆପଣଙ୍କ ପ୍ରଶ୍ନ ଟାଇପ୍ କରନ୍ତୁ।",
                typingText: "ସୁଶ୍ରୁତ ଭାବୁଛି...",
                inputPlaceholder: "ଆପଣଙ୍କ ପ୍ରଶ୍ନ ପଚାରନ୍ତୁ...",
                tooltipText: "🎤 କହିବା ପାଇଁ ମାଇକ୍ ଟ୍ୟାପ୍ କରନ୍ତୁ",
                emergencyResponse: `🚨 **ଏହା ଗମ୍ଭୀର ମନେହେଉଛି। ଦୟାକରି ତୁରନ୍ତ ଡାକ୍ତରୀ ସାହାଯ୍ୟ ନିଅନ୍ତୁ।**<br><br>ଜାତୀୟ ଜରୁରୀକାଳୀନ ନମ୍ବରକୁ କଲ୍ କରନ୍ତୁ: <b>112</b><br>କିମ୍ବା ଆମ୍ବୁଲାନ୍ସ ପାଇଁ କଲ୍ କରନ୍ତୁ: <b>108</b>`,
                diseaseAlertTitle: "ନୋଏଡା ପାଇଁ ସ୍ୱାସ୍ଥ୍ୟ ସତର୍କତା (ସେପ୍ଟେମ୍ବର 2025)",
                diseaseAlertDengueTitle: "ଡେଙ୍ଗୁ ଓ ମ୍ୟାଲେରିଆ ସତର୍କତା 🦟",
                diseaseAlertDengueInfo: "ମୌସୁମୀ ପରେ ମଶାବାହିତ ରୋଗ ବୃଦ୍ଧି ପାଏ। କୁଲର ଓ ପାତ୍ର ସଫା କରି ମଶାଙ୍କ ବଂଶବୃଦ୍ଧି ରୋକନ୍ତୁ। ମଶା ଘଉଡ଼ାଇବା ଔଷଧ ବ୍ୟବହାର କରନ୍ତୁ ଏବଂ ମଶାରି ଟାଙ୍ଗି ଶୁଅନ୍ତୁ।",
                diseaseAlertViralTitle: "ଜଳବାହିତ ରୋଗ ସତର୍କତା 💧",
                diseaseAlertViralInfo: "ଟାଇଫଏଡ୍ ଓ ଜଣ୍ଡିସ୍ ହେବାର ଆଶଙ୍କା ଅଧିକ। କେବଳ ସିଝା କିମ୍ବା ଫିଲ୍ଟର୍ ହୋଇଥିବା ପାଣି ପିଅନ୍ତୁ, ରାସ୍ତାକଡ଼ ଖାଦ୍ୟରୁ ଦୂରେଇ ରୁହନ୍ତୁ ଏବଂ ବାରମ୍ବାର ହାତ ଧୁଅନ୍ତୁ।",
                doctorDisclaimer: "ଦୟାକରି ଧ୍ୟାନ ଦିଅନ୍ତୁ: ଏହା ସର୍ବସାଧାରଣରେ ଉପଲବ୍ଧ ତଥ୍ୟ ଉପରେ ଆଧାରିତ ଏକ ନମୁନା ତାଲିକା ଏବଂ ଏହା ବର୍ତ୍ତମାନର କିମ୍ବା ସମ୍ପୂର୍ଣ୍ଣ ନୁହେଁ। ଡାକ୍ତରଙ୍କ ଉପଲବ୍ଧତା ନିଶ୍ଚିତ କରିବା ଏବଂ ଏକ ଆପଏଣ୍ଟମେଣ୍ଟ ବୁକ୍ କରିବା ପାଇଁ ଦୟାକରି ସିଧାସଳଖ ଡାକ୍ତରଖାନା ସହିତ ଯୋଗାଯੋଗ କରନ୍ତୁ।",
                dietFormTitle: "ଏକ ବ୍ୟକ୍ତିଗତ ଡାଏଟ୍ ଯୋଜନା ପାଆନ୍ତୁ",
                dietFormSubtitle: "ଦୟାକରି ନିମ୍ନରେ ଆପଣଙ୍କ ବିବରଣୀ ପ୍ରଦାନ କରନ୍ତୁ:",
                ageLabel: "ଆପଣଙ୍କ ବୟସ:",
                genderLabel: "ଆପଣଙ୍କ ଲିଙ୍ଗ:",
                goalLabel: "ଆପଣଙ୍କ ଲକ୍ଷ୍ୟ:",
                agePlaceholder: "ବୟସ ପ୍ରବେଶ କରନ୍ତୁ",
                genderMale: "ପୁରୁଷ",
                genderFemale: "ମହିଳା",
                goalLoose: "ଓଜନ ହ୍ରାସ",
                goalGain: "ଓଜନ ବୃଦ୍ଧି",
                goalMaintain: "ଓଜନ ବଜାୟ ରଖିବା",
                generateBtn: "ଯୋଜନା ସୃଷ୍ଟି କରନ୍ତୁ",
                dietChartGenerating: "ଆପଣଙ୍କ ବ୍ୟକ୍ତିଗତ ଡାଏଟ୍ ଚାର୍ଟ ପ୍ରସ୍ତୁତ କରାଯାଉଛି...",
                chartGeneratedMessage: "ଆପଣଙ୍କ ବିବରଣୀ ଉପରେ ଆଧାର କରି ଏକ ନମୁନା ଡାଏଟ୍ ଚାର୍ଟ ଏଠାରେ ଦିଆଯାଇଛି। ଆପଣଙ୍କର ନିର୍ଦ୍ଦିଷ୍ଟ ଆବଶ୍ୟକତା ଅନୁଯାୟୀ ଏକ ଯୋଜନା ପାଇଁ ଜଣେ ପେସାଦାର ପୁଷ୍ଟିକର ବିଶେଷଜ୍ଞ କିମ୍ବା ଡାକ୍ତରଙ୍କ ସହିତ ପରାମର୍ଶ କରିବାକୁ ମନେରଖନ୍ତୁ।",
                nearbyDoctorsGenerating: "ନିକଟସ୍ଥ ଡାକ୍ତରମାନଙ୍କୁ ଖୋଜାଯାଉଛି...",
                locationPermissionDenied: "ସ୍ଥାନ ପ୍ରବେଶ ପ୍ରତ୍ୟାଖ୍ୟାନ କରାଯାଇଛି। ଦୟାକରି ନିକଟସ୍ଥ ଡାକ୍ତରମାନଙ୍କୁ ଖୋଜିବା ପାଇଁ ଆପଣଙ୍କ ବ୍ରାଉଜର ସେଟିଙ୍ଗ୍‌ରେ ଏହାକୁ ସକ୍ଷମ କରନ୍ତୁ।"
            },
            te: {
                disclaimer: "⚠️ ముఖ్య గమనిక: ఇది సహాయం కోసం మాత్రమే. తీవ్రమైన సమస్యల కోసం వైద్యుడిని సంప్రదించండి.",
                mainTitle: "సుశ్రుత",
                subTitle: "మీ ఆరోగ్య సహాయకుడు",
                quickBtnFever: "జ్వరం",
                quickBtnCough: "దగ్గు",
                quickBtnVaccine: "టీకా",
                quickBtnStomach: "కడుపు నొప్పి",
                quickBtnDiet: "ఆహార ప్రణాళిక",
                quickBtnMentalHealth: "మానసిక ఆరోగ్యం",
                quickBtnWomen: "మహిళల ఆరోగ్యం",
                quickBtnNearby: "సమీప వైద్యుడు",
                quickBtnEmergency: "అత్యవసరం",
                queryFever: "జ్వరం యొక్క లక్షణాలు ఏమిటి?",
                queryCough: "దగ్గును ఎలా తగ్గించాలి?",
                queryVaccine: "పిల్లల టీకాల గురించి",
                queryStomach: "కడుపు నొప్పికి ఇంటి నివారణలు",
                queryDiet: "ఆరోగ్యకరమైన ఆహారం కోసం సాధారణ సలహా",
                queryMentalHealth: "మానసిక క్షేమాన్ని ఎలా మెరుగుపరచుకోవాలి?",
                queryWomen: "మహిళల సాధారణ ఆరోగ్య సమస్యలు",
                queryEmergency: "నాకు అత్యవసర సహాయం కావాలి",
                helpTitle: "<span>📚</span> నేను మీకు ఎలా సహాయపడగలను?",
                helpList: `• వ్యాధి లక్షణాలను తెలుసుకోండి<br>• ఇంటి నివారణలను పొందండి<br>• టీకాల గురించి తెలుసుకోండి`,
                initialBotGreeting: "🙏 నమస్కారం! నేను సుశ్రుత, మీ AI ఆరోగ్య సహాయకుడిని!",
                initialBotInstruction: "నేను ఆరోగ్య సమస్యలతో సహాయపడగలను. పై బటన్లను ఉపయోగించండి లేదా మీ ప్రశ్నను టైప్ చేయండి.",
                typingText: "సుశ్రుత ఆలోచిస్తోంది...",
                inputPlaceholder: "మీ ప్రశ్నను అడగండి...",
                tooltipText: "🎤 మాట్లాడటానికి మైక్‌ను నొక్కండి",
                emergencyResponse: `🚨 **ఇది తీవ్రంగా ఉంది. దయచేసి తక్షణ వైద్య సహాయం తీసుకోండి.**<br><br>జాతీయ అత్యవసర నంబర్‌కు కాల్ చేయండి: <b>112</b><br>లేదా అంబులెన్స్ కోసం కాల్ చేయండి: <b>108</b>`,
                diseaseAlertTitle: "నోయిడా కోసం ఆరోగ్య హెచ్చరికలు (సెప్టెంబర్ 2025)",
                diseaseAlertDengueTitle: "డెంగ్యూ & మలేరియా హెచ్చరిక 🦟",
                diseaseAlertDengueInfo: "రుతుపవనాల తర్వాత దోమల ద్వారా பரவும் நோய்கள் పెరుగుతాయి. కూలర్లు మరియు కుండలను శుభ్రపరచడం ద్వారా దోమల ఉత్పత్తిని నివారించండి. దోమల నివారణలను ఉపయోగించండి మరియు దోమతెర కింద నిద్రించండి.",
                diseaseAlertViralTitle: "నీటి ద్వారా பரவும் వ్యాధుల హెచ్చరిక 💧",
                diseaseAlertViralInfo: "టైఫాయిడ్ & కామెర్ల ప్రమాదం ఎక్కువగా ఉంది. కాచిన లేదా ఫిల్టర్ చేసిన నీటిని మాత్రమే త్రాగండి, వీధి ఆహారాన్ని నివారించండి మరియు చేతులను తరచుగా కడుక్కోండి.",
                doctorDisclaimer: "దయచేసి గమనించండి: ఇది బహిరంగంగా అందుబాటులో ఉన్న డేటా ఆధారంగా ఒక నమూనా జాబితా మరియు ప్రస్తుత లేదా పూర్తి కాదు. వైద్యుడి లభ్యతను ధృవీకరించడానికి మరియు అపాయింట్‌మెంట్ బుక్ చేయడానికి దయచేసి నేరుగా ఆసుపత్రిని సంప్రదించండి.",
                dietFormTitle: "వ్యక్తిగత ఆహార ప్రణాళికను పొందండి",
                dietFormSubtitle: "దయచేసి మీ వివరాలను క్రింద ఇవ్వండి:",
                ageLabel: "మీ వయస్సు:",
                genderLabel: "మీ లింగం:",
                goalLabel: "మీ లక్ష్యం:",
                agePlaceholder: "వయస్సును నమోదు చేయండి",
                genderMale: "పురుషుడు",
                genderFemale: "మహిళ",
                goalLoose: "బరువు తగ్గడం",
                goalGain: "బరువు పెరగడం",
                goalMaintain: "బరువు నిర్వహించడం",
                generateBtn: "ప్రణాళికను రూపొందించండి",
                dietChartGenerating: "మీ వ్యక్తిగత ఆహార ప్రణాళిక రూపొందించబడుతోంది...",
                chartGeneratedMessage: "మీ వివరాల ఆధారంగా ఒక నమూనా ఆహార పట్టిక ఇక్కడ ఉంది. మీ నిర్దిష్ట అవసరాలకు అనుగుణంగా ఒక ప్రణాళిక కోసం ఒక వృత్తిపరమైన పోషకాహార నిపుణుడు లేదా వైద్యుడిని సంప్రదించడం గుర్తుంచుకోండి।"
            }
        };

        // --- UI Update Function ---
        function updateUIText(lang) {
            const t = translations[lang] || translations.en; // Fallback to English

            // Update Header
            const disclaimerBanner = document.getElementById('disclaimer-banner');
            if (disclaimerBanner) {
                disclaimerBanner.innerText = t.disclaimer;
            }
            const mainTitle = document.getElementById('main-title');
            if (mainTitle) {
                mainTitle.innerText = t.mainTitle;
            }
            const subTitle = document.getElementById('sub-title');
            if (subTitle) {
                subTitle.innerText = t.subTitle;
            }

            // Update Quick Actions
            const quickButtons = [
                { id: 'quick-btn-fever', icon: '🌡️', text: t.quickBtnFever, query: t.queryFever },
                { id: 'quick-btn-cough', icon: '😤', text: t.quickBtnCough, query: t.queryCough },
                { id: 'quick-btn-vaccine', icon: '💉', text: t.quickBtnVaccine, query: t.queryVaccine },
                { id: 'quick-btn-stomach', icon: '🤢', text: t.quickBtnStomach, query: t.queryStomach },
                { id: 'quick-btn-diet', icon: '🥗', text: t.quickBtnDiet, query: 'show_diet_plan_form' },
                { id: 'quick-btn-mental-health', icon: '🧠', text: t.quickBtnMentalHealth, query: t.queryMentalHealth },
                { id: 'quick-btn-women', icon: '👩‍⚕️', text: t.quickBtnWomen, query: t.queryWomen },
                { id: 'quick-btn-nearby', icon: '🏥', text: t.quickBtnNearby, query: 'show_nearby_doctors' },
                { id: 'quick-btn-emergency', icon: '🚨', text: t.quickBtnEmergency, query: t.queryEmergency },
            ];
            
            quickButtons.forEach(btnInfo => {
                const btnElement = document.getElementById(btnInfo.id);
                if(btnElement) {
                    btnElement.innerHTML = `<span class="icon">${btnInfo.icon}</span><span>${btnInfo.text}</span>`;
                    btnElement.dataset.query = btnInfo.query;
                }
            });

            // Update Disease Alert
            const diseaseAlertTitleElement = document.getElementById('disease-alert-title');
            const diseaseAlertContentElement = document.getElementById('disease-alert-content');
            if (diseaseAlertTitleElement && diseaseAlertContentElement) {
                diseaseAlertTitleElement.innerText = t.diseaseAlertTitle;
                diseaseAlertContentElement.innerHTML = `
                    <p><strong>${t.diseaseAlertDengueTitle}:</strong> ${t.diseaseAlertDengueInfo}</p>
                    <p><strong>${t.diseaseAlertViralTitle}:</strong> ${t.diseaseAlertViralInfo}</p>
                `;
            }

            // Update Initial Message Area
            if (initialMessageContainer && initialMessageContainer.style.display !== 'none') {
                initialMessageContainer.innerHTML = `
                    <div class="help-section">
                        <div class="help-title">${t.helpTitle}</div>
                        <div class="help-list">${t.helpList}</div>
                    </div>
                    <div class="message bot-message">
                        <p class="font-bold text-gray-800 mb-2">${t.initialBotGreeting}</p>
                        <p class="text-gray-600">${t.initialBotInstruction}</p>
                    </div>
                `;
            }

            // Update other elements
            const typingTextElement = document.getElementById('typing-text');
            if(typingTextElement) {
                typingTextElement.innerText = t.typingText;
            }
            if(messageInput) {
                messageInput.placeholder = t.inputPlaceholder;
            }
            const tooltipTextElement = document.getElementById('tooltip-text');
            if(tooltipTextElement) {
                tooltipTextElement.innerText = t.tooltipText;
            }
        }


        // --- Event Listeners ---
        window.addEventListener('load', () => {
            updateUIText(currentLanguage); // Set initial language on load
            initKeyboard(); // Initialize virtual keyboard
        });

        document.getElementById('close-alert-btn').addEventListener('click', () => {
            const banner = document.getElementById('disease-alert');
            banner.classList.add('collapsed');
        });

        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
        });
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const query = btn.dataset.query;
                if (query === 'show_diet_plan_form') {
                    showDietPlanForm();
                } else if (query === 'show_nearby_doctors') {
                    showNearbyDoctors();
                } else {
                    messageInput.value = query;
                    sendMessage();
                }
            });
        });
        voiceBtn.addEventListener('click', toggleVoiceRecognition);
        closeTooltipBtn.addEventListener('click', () => voiceTooltip.classList.add('hidden'));
        headerToggleBtn.addEventListener('click', () => {
            document.getElementById('disease-alert').classList.toggle('collapsed');
            quickActions.classList.toggle('collapsed');
            headerToggleIcon.classList.toggle('rotate-180');
        });


        // --- Core Functions ---
        function sendMessage() {
            const userMessage = messageInput.value.trim();
            if (!userMessage || apiKey === "PASTE_YOUR_GOOGLE_AI_API_KEY_HERE") return;

            if (initialMessageContainer) {
                initialMessageContainer.style.display = 'none';
            }

            addMessage(userMessage, 'user');
            messageInput.value = '';
            if (keyboard) {
                keyboard.setInput(""); // Clear keyboard input
            }
            showTypingIndicator(true);
            
            if (isEmergency(userMessage)) {
                const emergencyResponse = getEmergencyResponse(currentLanguage);
                setTimeout(() => {
                    showTypingIndicator(false);
                    addMessage(marked.parse(emergencyResponse), 'bot');
                }, 1000);
            } else {
                callGeminiAPI(userMessage);
            }
        }

        async function callGeminiAPI(prompt) {
            try {
                // Enhanced system prompt for better, safer, and more empathetic responses
                const systemPrompt = `You are Sushruta, an AI health assistant for India. Your primary goal is to provide helpful, safe, and preliminary health information in a calm, empathetic, and reassuring tone. You must respond ONLY in the user's selected language: ${currentLanguage}.
                
                **CONTEXT:** The current date is Friday, September 26, 2025. The user is located in Noida, Uttar Pradesh, India. Tailor your health advice to be relevant to this time and location (post-monsoon season).

                **CRITICAL SAFETY INSTRUCTIONS:**
                1.  **ALWAYS start your response with a clear disclaimer:** "${translations[currentLanguage].disclaimer} Please consult a doctor for any health concerns." (Translate this disclaimer accurately to the user's language).
                2.  **NEVER provide a diagnosis.** You can list possible symptoms or causes, but you must never state what condition the user has. Frame suggestions carefully, e.g., "Some people find relief by..."
                3.  **FOR ANY SERIOUS SYMPTOMS** (e.g., chest pain, difficulty breathing, severe bleeding, high fever in infants, confusion, sudden weakness), immediately advise the user to seek emergency medical help. Provide the national emergency number (112) and ambulance number (108).
                4.  **KEEP INFORMATION GENERAL.** Avoid specific dosages for medications. Recommend consulting a doctor or pharmacist for treatment plans and medication advice.
                5.  **USE SIMPLE LANGUAGE.** Avoid complex medical jargon. Explain concepts clearly and concisely.

                **CONTENT & FORMATTING GUIDELINES:**
                - **Use Markdown for formatting.** Use headings, bold text, and bulleted lists (\`*\` or \`-\`) to structure information and make it easy to read.
                - **Use emojis** to make the content more friendly and approachable (e.g., 🩺, 🙏, 😊, 🥗).
                - **Structure your response clearly:**
                    1.  Mandatory Disclaimer (Translated).
                    2.  Empathetic acknowledgment of the user's query.
                    3.  Clear, structured answer using Markdown.
                    4.  Actionable, safe recommendations (e.g., "Consider speaking to a doctor," "You might find it helpful to...").

                **NEW INSTRUCTION: PROVIDING DOCTOR INFORMATION**
                After you provide the health information for the user's query, you MUST add a new section titled "### 🩺 Find a Specialist (Examples)".
                In this section, you must:
                1.  Identify the relevant medical specialty for the user's query (e.g., for a skin rash, the specialty is Dermatology; for a heart issue, it's Cardiology; for fever or cold, it is General Medicine).
                2.  Search the "INTERNAL KNOWLEDGE BASE" provided below for doctors or departments matching that specialty, prioritizing those in Noida/Delhi NCR.
                3.  List a few relevant examples of doctors or departments you find. Include their name, designation, and hospital.
                4.  **CRITICALLY IMPORTANT:** You MUST include the following disclaimer at the end of this section: "${translations[currentLanguage].doctorDisclaimer}" (Translate this disclaimer to the user's language).
                5.  If you cannot find a relevant specialist in the knowledge base, state that you don't have specific doctor information for this condition and recommend contacting a major government hospital like AIIMS, New Delhi for a referral.

                ---

                **INTERNAL KNOWLEDGE BASE: DOCTOR DIRECTORY (SAMPLE DATA)**
                
                **NOIDA & DELHI NCR REGION:**
                **1. Fortis Hospital, Noida**
                - Cardiology: Dr. Subrat Akhoury (Director)
                - Neurology: Dr. Jyoti Bala Sharma (Director)
                - Orthopaedics & Joint Replacement: Dr. Atul Mishra (Director)
                - Gastroenterology & Hepatobiliary Sciences: Dr. Ajay Kumar (Director)
                - Pulmonology: Dr. Rahul Sharma (Sr. Consultant)

                **2. Max Healthcare, Noida**
                - Internal Medicine: Dr. V K Jain (Sr. Director)
                - Paediatrics (Ped): Dr. Ankur Kumar (Associate Consultant)
                - Obstetrics & Gynaecology: Dr. Anjali Kumar (Director)
                - Cardiology: Dr. Girish B. Navasundi (Sr. Director)

                **3. All India Institute of Medical Sciences (AIIMS), New Delhi (Major Referral Hospital)**
                - General Medicine / Pulmonology: Dr. Randeep Guleria (Former Director, renowned specialist)
                - Cardiology: Dr. Vinay Kumar Bahl (Head of Department)
                - Neurology: Dr. M.V. Padma Srivastava (Head of Department)
                - Paediatrics: Dr. V. K. Paul (Head of Department, Member NITI Aayog)

                **OTHER REGIONS:**
                **4. Nil Ratan Sircar (NRS) Medical College & Hospital, Kolkata, West Bengal**
                - Cardiology: Prof. (Dr.) Manoranjan Mandal
                - General Medicine: Dr. Milan Chakraborty
                - Gynecology & Obstetrics: Dr. Runa Bal
                - Paediatrics Medicine: Dr. Asim Kr Mallick
                - Psychiatry: Dr. Asish Mukhopadhyay

                **5. Sheikh Bhikhari Medical College & Hospital, Hazaribag, Jharkhand**
                - Medicine: DR S K SINGH (Professor & Principal), DR S. K. SINHA (Professor & HOD)
                - Surgery: DR VINOD KUMAR (Professor)
                - Obstetrics & Gynecology (OBGY): DR SWETA LAL (Assistant Professor)
                - Paediatrics: DR CHITIZ ANAND (Assistant Professor)
                - Dermatology: DR. FIRDOUS JAHAN (Assistant Professor)

                **6. MKCG Medical College & Hospital, Berhampur, Odisha**
                - General Medicine: Prof Dr S.S. Baisakh (Professor)
                - Orthopaedics: Dr. Bikram Keshari Mohanty (Professor)
                - Cardiology: Dr. A.K. Mohapatra (Professor)
                - Nephrology: Dr. J.K. Sahu (Professor)`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const botResponse = result.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I couldn't process that. Could you try rephrasing?";
                
                // Parse the Markdown response to HTML
                addMessage(marked.parse(botResponse), 'bot');

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                addMessage("I'm having trouble connecting right now. Please try again later.", 'bot');
            } finally {
                showTypingIndicator(false);
            }
        }

        function showNearbyDoctors() {
            const t = translations[currentLanguage];
            addMessage(t.nearbyDoctorsGenerating, 'bot');
            showTypingIndicator(true);

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        // The prompt is updated to be more direct, asking for Noida doctors from the KB.
                        const prompt = `A user in Noida needs to find a doctor. Based on the INTERNAL KNOWLEDGE BASE, list a few doctors from different specialties available in the Noida/Delhi NCR region.
                        `;
                        callGeminiAPI(prompt);
                    },
                    (error) => {
                        showTypingIndicator(false);
                        console.error('Geolocation error:', error);
                        addMessage(t.locationPermissionDenied, 'bot');
                    }
                );
            } else {
                showTypingIndicator(false);
                addMessage("Geolocation is not supported by your browser.", 'bot');
            }
        }
        
        // --- Diet Plan Form Functions ---
        function showDietPlanForm() {
            const t = translations[currentLanguage];
            chatArea.innerHTML = `
                <div class="message bot-message fade-in">
                    <div class="px-4 py-6 sm:px-8 bg-white shadow-xl rounded-2xl border border-gray-200">
                        <div class="flex items-center justify-center space-x-2 text-center text-gray-800 mb-4">
                            <h2 class="text-2xl font-bold">${t.dietFormTitle}</h2>
                        </div>
                        <p class="text-gray-500 mb-6 text-center">${t.dietFormSubtitle}</p>
                        
                        <div class="space-y-6">
                            <div class="relative">
                                <label for="age-input" class="block text-sm font-medium text-gray-700 mb-1">${t.ageLabel}</label>
                                <input type="number" id="age-input" placeholder="${t.agePlaceholder}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 transition-shadow duration-200">
                            </div>
                            
                            <div class="relative">
                                <label for="gender-select" class="block text-sm font-medium text-gray-700 mb-1">${t.genderLabel}</label>
                                <select id="gender-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-orange-500 transition-shadow duration-200">
                                    <option value="male">${t.genderMale}</option>
                                    <option value="female">${t.genderFemale}</option>
                                </select>
                            </div>
                            
                            <div class="relative">
                                <label for="goal-select" class="block text-sm font-medium text-gray-700 mb-1">${t.goalLabel}</label>
                                <select id="goal-select" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-orange-500 transition-shadow duration-200">
                                    <option value="lose">${t.goalLoose}</option>
                                    <option value="gain">${t.goalGain}</option>
                                    <option value="maintain">${t.goalMaintain}</option>
                                </select>
                            </div>
                        </div>

                        <button id="generate-diet-btn" class="mt-8 w-full py-3 rounded-lg text-white font-semibold transition-transform duration-200 transform-gpu hover:scale-105 active:scale-95 shadow-lg"
                                style="background: linear-gradient(135deg, #F9A825, #F57F17);">
                            ${t.generateBtn}
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('generate-diet-btn').addEventListener('click', generateDietPlan);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        async function generateDietPlan() {
            const age = document.getElementById('age-input').value;
            const gender = document.getElementById('gender-select').value;
            const goal = document.getElementById('goal-select').value;
            const t = translations[currentLanguage];

            if (!age) {
                // In-chat message box for validation
                addMessage('Please enter your age.', 'bot');
                return;
            }

            const prompt = `Generate a comprehensive and well-structured, 7-day diet chart based on the following information:
- Age: ${age} years
- Gender: ${gender}
- Weight Goal: ${goal}
The diet chart should be suitable for a general audience in India and should include a variety of meals for breakfast, lunch, and dinner. Provide healthy snacks and drink suggestions as well. Use simple language and clear formatting.
`;
            
            chatArea.innerHTML = '';
            addMessage(t.dietChartGenerating, 'bot');
            showTypingIndicator(true);

            // Re-adding the safety prompt before the content prompt
            const fullPrompt = `${prompt}
---
${t.chartGeneratedMessage}
---`;
            
            callGeminiAPI(fullPrompt);
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.innerHTML = text; // Use innerHTML directly as text is now parsed HTML
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator(show) {
            typingIndicator.style.display = show ? 'flex' : 'none';
            if (show) {
                chatArea.scrollTop = chatArea.scrollHeight;
            }
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            const langBtn = document.getElementById(`lang-${lang}`);
            if (langBtn) {
                langBtn.classList.add('active');
            }
            updateUIText(lang);
            // Update keyboard layout
            if (keyboard) {
                keyboard.setOptions({
                    layout: keyboardLayouts[lang],
                    layoutName: 'default' // Reset to default layout on language change
                });
            }
        }

        // --- Voice Recognition ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        let isListening = false;
        
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onstart = () => {
                isListening = true;
                voiceBtn.classList.add('listening');
            };
            
            recognition.onend = () => {
                isListening = false;
                voiceBtn.classList.remove('listening');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                messageInput.value = transcript;
                sendMessage();
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
            };

        } else {
            voiceBtn.style.display = 'none'; // Hide voice button if not supported
        }

        function toggleVoiceRecognition() {
            if (!recognition) return;
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.lang = getLangCodeForVoice(currentLanguage);
                recognition.start();
            }
        }
        
        function getLangCodeForVoice(lang) {
            const langMap = {
                'en': 'en-IN',
                'hi': 'hi-IN',
                'bn': 'bn-IN',
                'ta': 'ta-IN',
                'od': 'or-IN',
                'te': 'te-IN'
            };
            return langMap[lang] || 'en-IN';
        }
        
        // --- Emergency Detection ---
        function isEmergency(text) {
            const emergencyKeywords = [
                // English
                'chest pain', 'heart attack', 'stroke', 'can\'t breathe', 'not breathing', 'severe bleeding', 'unconscious', 'poison', 'suicide', 'emergency', 'accident', 'seizure',
                // Hindi (and other regional languages)
                'छाती में दर्द', 'दिल का दौरा', 'लकवा', 'सांस नहीं ले पा रहा', 'बेहोश', 'गंभीर रक्तस्राव', 'जहर', 'आत्महत्या', 'आपातकालीन', 'दुर्घटना'
            ];
            const lowerText = text.toLowerCase();
            return emergencyKeywords.some(keyword => lowerText.includes(keyword));
        }

        function getEmergencyResponse(lang) {
            const t = translations[lang] || translations.en;
            return t.emergencyResponse;
        }

        // Show voice tooltip on first visit
        if (!localStorage.getItem('visitedSushruta')) {
            setTimeout(() => {
                voiceTooltip.classList.remove('hidden');
            }, 2000);
            localStorage.setItem('visitedSushruta', 'true');
        }

        // --- Virtual Keyboard Logic ---
        const Keyboard = window.SimpleKeyboard.default;
        let keyboard;
        const languageCycle = ['en', 'hi', 'bn', 'ta', 'od', 'te'];

        const keyboardLayouts = {
            en: {
                'default': [
                    'q w e r t y u i o p', 'a s d f g h j k l', '{shift} z x c v b n m {backspace}', '{next} {space} {hide} {enter}'
                ],
                'shift': [
                    'Q W E R T Y U I O P', 'A S D F G H J K L', '{shift} Z X C V B N M {backspace}', '{next} {space} {hide} {enter}'
                ]
            },
            hi: {
                'default': [
                    'ौ ै ा ी ू ू े ो ् ृ {backspace}',
                    'त थ द ध न प फ ब भ म',
                    'य र ल व श ष स ह च छ ज झ',
                    'क़ ख ग़ ज़ ड़ ढ़ फ़ य़ ॉ ञ',
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'औ ऐ आ ई ऊ ब भ र् ज्ञ ऋ ॐ',
                    'त् थ् द् ध् न् प् फ् ब् भ् म्',
                    'य् र् ल् व् श् ष् स् ह् च् छ् ज् झ्',
                    'ट ठ ड ढ ण क ख ग घ ङ ञ्',
                    '{shift} {next} {space} {hide} {enter}'
                ]
            },
            bn: {
                'default': [
                    'ৌ ৈ া ী ু ূ ে ো ্ ৃ {backspace}',
                    'ত থ দ ধ ন প ফ ব ভ ম',
                    'য র ল ব শ ষ স হ চ ছ জ ঝ ঞ',
                    'ট ঠ ড ঢ ণ ক খ গ ঘ ঙ',
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'ঔ ঐ অ ই উ ঊ ঋ এ ঐ ও ঔ',
                    'ৎ থ্ দ্ ধ্ ন্ প্ ফ্ ব্ ভ্ ম্',
                    'য্ র ্ ল্ ব্ শ্ ষ ্ স্ হ্ চ্ ছ্ জ্ ঝ্ ঞ্',
                    'ট্ ঠ্ ড্ ঢ্ ণ্ ক্ খ্ গ্ ঘ্ ঙ্',
                    '{shift} {next} {space} {hide} {enter}'
                ]
            },
            ta: {
                'default': [
                    'க ச ட த ப ய ர ல வ ழ ள {backspace}', 
                    'அ ஆ இ ஈ உ ஊ எ ஏ ஐ ஒ ஓ ஔ', 
                    '் ா ி ீ ு ூ ெ ே ை ொ ோ ௌ ஃ', 
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'ங ஞ ண ந ம ன ற ன', 
                    'க் ச் ட் த் ப் ய் ர் ல் வ் ழ் ள்', 
                    'ஜ் ஷ் ஸ் ஹ் ஸ்ரீ {backspace}', 
                    '{shift} {next} {space} {hide} {enter}'
                ]
            },
              od: {
                'default': [
                    'ୌ ୈ ା ୀ ୂ ୄ େ ୋ ୍ ୃ {backspace}',
                    'ତ ଥ ଦ ଧ ନ ପ ଫ ବ ଭ ମ',
                    'ଯ ର ଲ ଵ ଶ ଷ ସ ହ ଚ ଛ ଜ ଝ ଞ',
                    'ଟ ଠ ଡ ଢ ଣ କ ଖ ଗ ଘ ଙ',
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'ଔ ঐ ଆ ଈ ଉ ଊ ଋ ଏ ଓ ଔ',
                    'ତ୍ ଥ୍ ଦ୍ ଧ୍ ନ ପ୍ ଫ୍ ବ୍ ଭ୍ ମ୍',
                    'ଯ୍ ର୍ ଲ୍ ଵ୍ ଶ୍ ଷ୍ ସ୍ ହ୍ ଚ୍ ଛ୍ ଜ୍ ଝ୍ ଞ୍',
                    'ଟ୍ ଠ୍ ଡ୍ ଢ୍ ଣ କ୍ ଖ୍ ଗ୍ ଘ୍ ଙ୍',
                    '{shift} {next} {space} {hide} {enter}'
                ]
            },
            te: {
                 'default': [
                    'ౌ ై ా ీ ు ూ ె ో ్ ృ {backspace}',
                    'త థ ద ధ న ప ఫ బ భ మ',
                    'య ర ల వ శ ష స హ చ ఛ జ ఝ ఞ',
                    'ట ఠ డ ఢ ణ క ఖ గ ఘ ఙ',
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'ఔ ఐ ఆ ఈ ఉ ఊ ఋ ఎ ఏ ఒ ఓ',
                    'త్ థ్ ద్ ధ్ న ప్ ఫ్ బ్ భ్ మ్',
                    'య్ ర్ ల వ శ ష స హ చ ఛ జ ఝ ఞ',
                    'ట్ ఠ్ డ్ ఢ్ ణ్ క్ ఖ్ గ్ ఘ్ ఙ్',
                    '{shift} {next} {space} {hide} {enter}'
                ]
            }
        };

        function initKeyboard() {
            keyboard = new Keyboard({
                onChange: input => onKeyboardChange(input),
                onKeyPress: button => onKeyPress(button),
                layoutName: "default", // Always start with default layout
                layout: keyboardLayouts[currentLanguage],
                display: {
                    '{next}': '🌐',
                    '{enter}': 'Send',
                    '{shift}': 'Shift',
                    '{space}': ' ',
                    '{backspace}': '⌫',
                    '{hide}': 'Done'
                }
            });
        }
        
        function onKeyboardChange(input) {
            messageInput.value = input;
        }

        function onKeyPress(button) {
            if (button === "{shift}" || button === "{lock}") handleShift();
            if (button === "{enter}") sendMessage();
            if (button === "{next}") handleNextLanguage();
            if (button === "{hide}") hideKeyboard();
        }

        function handleShift() {
            const currentLayout = keyboard.options.layoutName;
            const newLayoutName = currentLayout === "default" ? "shift" : "default";
            keyboard.setOptions({
                layoutName: newLayoutName
            });
        }

        function handleNextLanguage() {
            const currentIndex = languageCycle.indexOf(currentLanguage);
            const nextIndex = (currentIndex + 1) % languageCycle.length;
            const nextLang = languageCycle[nextIndex];
            setLanguage(nextLang);
        }

        function showKeyboard() {
            keyboardContainer.classList.add('visible');
            chatArea.classList.add('chat-area-with-keyboard');
            keyboardBtn.classList.add('active');
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideKeyboard() {
            keyboardContainer.classList.remove('visible');
            chatArea.classList.remove('chat-area-with-keyboard');
            keyboardBtn.classList.remove('active');
        }

        keyboardBtn.addEventListener('click', () => {
            const isVisible = keyboardContainer.classList.contains('visible');
            if (isVisible) {
                hideKeyboard();
            } else {
                showKeyboard();
            }
        });

    </script>
</body>
</html>

