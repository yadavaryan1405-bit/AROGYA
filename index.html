<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- Removed restrictive CSP to allow Gemini API calls in this environment -->
    <title>Sushruta - AI Health Assistant</title>
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <!-- Virtual Keyboard -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/css/index.min.css">
    <script src="https://cdn.jsdelivr.net/npm/simple-keyboard@latest/build/index.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Devanagari:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* Base styles for all devices */
        html, body {
            height: 100%;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent; /* Disable tap highlight on mobile */
        }
        body {
            font-family: 'Inter', 'Noto Sans Devanagari', sans-serif;
            background: linear-gradient(135deg, #F9A825 0%, #F57F17 50%, #E65100 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px; 
        }
        
        .chat-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #F9A825 0%, #F57F17 50%, #E65100 100%);
            background-size: 200% 200%; /* For gradient animation */
            animation: gradient-animation 15s ease infinite; /* Added animation */
            color: white;
            padding: 1rem 1.5rem 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            flex-shrink: 0;
        }
        
        @keyframes gradient-animation { /* Keyframes for gradient animation */
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .logo-container {
            position: relative;
            z-index: 10;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            width: 100%;
            max-width: 280px;
            margin: 0.75rem auto 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 1rem;
            padding: 0.75rem;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }
        
        .lang-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
            margin-bottom: 1rem;
        }
        
        .lang-btn {
            padding: 0.5rem 1rem;
            border-radius: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .lang-btn:hover, .lang-btn.active {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }
        
        .disclaimer-banner {
            background: linear-gradient(90deg, #ef4444, #dc2626);
            color: white;
            text-align: center;
            font-size: 0.8rem;
            padding: 0.75rem 1rem;
            font-weight: 600;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .disclaimer-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s infinite;
        }
        
        .quick-actions {
            padding: 0.75rem;
            background: #f8fffe;
            display: flex;
            overflow-x: auto;
            flex-wrap: nowrap;
            justify-content: flex-start; /* Changed for better scroll alignment */
            gap: 0.75rem;
            border-bottom: 2px solid #e5e7eb;
            position: sticky;
            top: 0;
            z-index: 20;
            flex-shrink: 0;
            /* Removed properties that hide scrollbar for cross-browser visibility */
        }
        
        .quick-actions::-webkit-scrollbar {
            height: 8px; /* Made scrollbar visible */
        }
        
        /* Added styles for a custom scrollbar */
        .quick-actions::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }
        
        .quick-actions::-webkit-scrollbar-thumb {
            background: #fbbf24;
            border-radius: 4px;
        }
        .quick-actions::-webkit-scrollbar-thumb:hover {
            background: #f59e0b;
        }
        
        .quick-btn {
            padding: 0.5rem 0.75rem;
            border-radius: 1rem;
            background: white;
            border: 2px solid #e5e7eb;
            color: #374151;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            flex-shrink: 0;
        }
        
        .quick-btn .icon {
            font-size: 1.25rem;
        }
        
        .quick-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(249, 168, 37, 0.2);
            border-color: #F9A825;
            color: #F9A825;
        }
        
        .quick-btn.emergency, .quick-btn.women, .quick-btn.mental-health {
            color: white;
        }
        
        .quick-btn.emergency {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-color: #dc2626;
        }
        
        .quick-btn.emergency:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            box-shadow: 0 8px 20px rgba(220, 38, 38, 0.4);
        }
        
        .quick-btn.women {
            background: linear-gradient(135deg, #ec4899, #db2777);
            border-color: #db2777;
        }
        
        .quick-btn.women:hover {
            background: linear-gradient(135deg, #db2777, #be185d);
            box-shadow: 0 8px 20px rgba(219, 39, 119, 0.4);
        }

        .quick-btn.mental-health {
            background: linear-gradient(135deg, #38bdf8, #0ea5e9);
            border-color: #0ea5e9;
        }
        
        .quick-btn.mental-health:hover {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            box-shadow: 0 8px 20px rgba(14, 165, 233, 0.4);
        }

        .disease-alert {
            padding: 1rem 2.5rem 1rem 1rem; /* Added padding for the close button */
            margin: 0 1.5rem;
            background: linear-gradient(135deg, #eff6ff, #dbeafe);
            border: 2px solid #93c5fd;
            border-radius: 1rem;
            position: relative;
            top: -1rem;
            z-index: 15;
            box-shadow: 0 8px 20px rgba(191, 219, 254, 0.5);
            transition: all 0.5s ease-in-out; /* Added for smooth collapse */
        }

        .alert-close-btn {
            position: absolute;
            top: 50%;
            right: 0.5rem;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            color: #1e3a8a;
            font-size: 1.75rem;
            line-height: 1;
            cursor: pointer;
            padding: 0.25rem 0.5rem;
            border-radius: 50%;
            transition: background-color 0.2s ease;
        }

        .alert-close-btn:hover {
            background-color: rgba(30, 64, 175, 0.1);
        }

        .alert-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
        }

        .alert-content p {
            margin-bottom: 0.5rem;
            color: #1e40af;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .alert-content strong {
            font-weight: 600;
            color: #1c3d8a;
        }

        .chat-area {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: linear-gradient(180deg, #fefffe 0%, #f9fffe 100%);
            position: relative;
            transition: padding-bottom 0.4s ease; /* For keyboard */
        }

        .chat-area-with-keyboard {
            padding-bottom: 280px; /* Adjust based on keyboard height */
        }
        
        .chat-area::-webkit-scrollbar {
            width: 8px;
        }
        
        .chat-area::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .chat-area::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #F9A825, #F57F17);
            border-radius: 4px;
        }
        
        .message {
            margin-bottom: 1.5rem;
            animation: messageSlideIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
            line-height: 1.6;
        }
        
        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .user-message, .bot-message {
            max-width: 85%;
            padding: 1rem 1.25rem;
        }

        .user-message {
            background: linear-gradient(135deg, #F9A825 0%, #F57F17 100%);
            color: white;
            margin-left: auto;
            border-radius: 1.5rem 1.5rem 0.5rem 1.5rem;
            box-shadow: 0 4px 16px rgba(249, 168, 37, 0.3);
        }
        
        .bot-message {
            background: white;
            color: #1f2937;
            border: 2px solid #e5e7eb;
            border-radius: 1.5rem 1.5rem 1.5rem 0.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            position: relative;
        }
        
        .bot-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #F9A825, #F57F17);
            border-radius: 3px 0 0 3px;
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem;
            background: white;
            border-radius: 1.5rem;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            width: fit-content;
            margin-bottom: 1.5rem;
            border: 2px solid #e5e7eb;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: linear-gradient(45deg, #F9A825, #F57F17);
            animation: typingBounce 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0.32s; }
        
        @keyframes typingBounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        .input-area {
            background: #f8fffe;
            padding: 1rem 1rem;
            border-top: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            position: relative;
            flex-shrink: 0;
        }
        
        .voice-btn, .send-btn, .keyboard-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            flex-shrink: 0;
        }

        .keyboard-btn {
             background: linear-gradient(135deg, #60a5fa, #3b82f6);
             color: white;
        }

        .keyboard-btn.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .voice-btn {
            background: linear-gradient(135deg, #fbbf24, #f97316);
            color: white;
        }
        
        .voice-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 24px rgba(251, 191, 36, 0.4);
        }
        
        .voice-btn.listening {
            animation: voicePulse 1.5s infinite;
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        @keyframes voicePulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3); }
            50% { transform: scale(1.1); box-shadow: 0 8px 30px rgba(239, 68, 68, 0.5); }
        }
        
        .message-input {
            flex: 1;
            padding: 0.8rem 1.25rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 1.75rem;
            font-size: 16px; /* Prevents iOS zoom */
            transition: all 0.3s ease;
            outline: none;
            font-weight: 500;
        }
        
        .message-input:focus {
            border-color: #F9A825;
            box-shadow: 0 0 0 4px rgba(249, 168, 37, 0.1);
        }
        
        .send-btn {
            background: linear-gradient(135deg, #F9A825, #F57F17);
            color: white;
        }
        
        .send-btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 24px rgba(249, 168, 37, 0.4);
        }
        
        .send-btn:active {
            transform: translateY(0) scale(0.95);
        }
        
        .help-section {
            background: linear-gradient(135deg, #ebf4ff, #dbeafe);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin: 1rem 0;
            border: 2px solid #bfdbfe;
        }
        
        .help-title {
            color: #1e3a8a;
            font-weight: 700;
            font-size: 1.1rem;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .help-list {
            color: #1e3a8a;
            font-weight: 500;
            line-height: 1.7;
        }

        .voice-tooltip {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .voice-tooltip.hidden {
            opacity: 0;
            transform: translateY(5px);
            pointer-events: none;
        }
        
        /* Focus indicators for keyboard navigation */
        *:focus {
            outline: 3px solid #F9A825;
            outline-offset: 2px;
        }
        
        .lang-btn:focus {
            outline-color: white;
        }

        /* Collapsible section styles */
        .collapsible {
            max-height: 500px;
            transition: max-height 0.5s ease-in-out, opacity 0.3s ease-in-out, padding 0.5s, margin 0.5s;
            overflow: hidden;
        }

        .collapsed {
            max-height: 0;
            opacity: 0;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            margin-top: 0 !important;
            margin-bottom: 0 !important;
            border-width: 0 !important;
        }

        #header-toggle-icon.rotate-180 {
            transform: rotate(180deg);
        }

        /* --- Virtual Keyboard Styles --- */
        .keyboard-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: #e5e7eb;
            z-index: 100;
            transform: translateY(100%);
            transition: transform 0.4s ease-in-out;
            padding: 0.5rem;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
        }

        .keyboard-container.visible {
            transform: translateY(0);
        }

        .simple-keyboard {
            border-radius: 0.5rem;
        }

        .simple-keyboard.hg-theme-default {
            background-color: transparent;
            border: none;
        }

        .simple-keyboard.hg-theme-default .hg-button {
            background: white;
            border-bottom: 2px solid #d1d5db;
            color: #1f2937;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: background 0.2s ease, transform 0.1s ease;
        }
        .simple-keyboard.hg-theme-default .hg-button:active {
            transform: scale(0.95);
        }

        .simple-keyboard.hg-theme-default .hg-button.hg-function {
            background: #d1d5db;
        }

        /* Responsive Design */
        @media (min-width: 640px) {
            body {
                padding: 1.5rem;
            }
            .chat-container {
                max-width: 42rem;
                height: 90vh;
                max-height: 850px;
                border-radius: 1.5rem;
                box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.3);
                border: 2px solid rgba(255, 255, 255, 0.2);
            }
            .input-area {
                padding: 1rem 1.5rem;
                gap: 1rem;
            }
            .voice-btn, .send-btn, .keyboard-btn {
                width: 52px;
                height: 52px;
            }
            .message-input {
                padding: 1rem 1.5rem;
            }
        }

        @media (min-width: 1024px) {
            .chat-container {
                max-width: 48rem;
            }
            .message-input {
                font-size: 1.1rem;
            }
        }
        
    </style>
</head>
<body>
    <div class="chat-container">
        <!-- Medical Disclaimer Banner -->
        <div class="disclaimer-banner" id="disclaimer-banner">
            <!-- Text will be inserted by script -->
        </div>

        <!-- Header -->
        <header class="header">
            <div class="logo-container">
                <div class="lang-selector">
                    <button class="lang-btn active" onclick="setLanguage('hi')" id="lang-hi">हिंदी</button>
                    <button class="lang-btn" onclick="setLanguage('en')" id="lang-en">English</button>
                    <button class="lang-btn" onclick="setLanguage('bn')" id="lang-bn">বাংলা</button>
                    <button class="lang-btn" onclick="setLanguage('ta')" id="lang-ta">தமிழ்</button>
                    <button class="lang-btn" onclick="setLanguage('od')" id="lang-od">ଓଡ଼ିଆ</button>
                    <button class="lang-btn" onclick="setLanguage('te')" id="lang-te">తెలుగు</button>
                </div>
                <h1 id="main-title" class="text-2xl font-bold tracking-tight mb-1" style="font-family: 'Inter', sans-serif;"></h1>
                <p id="sub-title" class="text-base text-orange-100 font-semibold"></p>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div id="stat-free-value" class="text-2xl font-bold"></div>
                        <div id="stat-free-label" class="text-sm opacity-90"></div>
                    </div>
                    <div class="stat-card">
                        <div id="stat-247-value" class="text-2xl font-bold"></div>
                        <div id="stat-247-label" class="text-sm opacity-90"></div>
                    </div>
                </div>
            </div>
            
            <button id="header-toggle-btn" class="absolute bottom-[-1rem] bg-white text-gray-600 rounded-full p-1 shadow-md border-2 border-gray-200 transition-transform duration-300 z-10">
                <svg id="header-toggle-icon" class="w-6 h-6 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
            </button>
        </header>

        <!-- Disease Alert Section -->
        <div id="disease-alert" class="disease-alert collapsible">
            <div class="alert-header">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" style="width: 24px; height: 24px;">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                <h3 id="disease-alert-title" class="font-bold"></h3>
            </div>
            <div id="disease-alert-content" class="alert-content">
                <!-- Content will be inserted by script -->
            </div>
            <button id="close-alert-btn" title="Dismiss Alert" class="alert-close-btn">&times;</button>
        </div>

        <!-- Quick Actions -->
        <div id="quick-actions" class="quick-actions collapsible">
            <button id="quick-btn-fever" class="quick-btn"></button>
            <button id="quick-btn-cough" class="quick-btn"></button>
            <button id="quick-btn-vaccine" class="quick-btn"></button>
            <button id="quick-btn-stomach" class="quick-btn"></button>
            <button id="quick-btn-diet" class="quick-btn"></button>
            <button id="quick-btn-mental-health" class="quick-btn mental-health"></button>
            <button id="quick-btn-women" class="quick-btn women"></button>
            <button id="quick-btn-emergency" class="quick-btn emergency"></button>
        </div>

        <!-- Chat Area -->
        <main id="chatArea" class="chat-area">
            <div id="initialMessageContainer">
                 <!-- content from script -->
            </div>
            
            <!-- Enhanced Typing Indicator -->
            <div id="typingIndicator" class="typing-indicator" style="display: none;">
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <div class="typing-dot"></div>
                <span id="typing-text" class="ml-2 text-base text-gray-700 font-semibold"></span>
            </div>
        </main>
        
        <!-- Enhanced Input Area -->
        <footer class="input-area">
            <!-- Voice Tooltip -->
            <div id="voice-tooltip" class="voice-tooltip hidden" style="position: absolute; bottom: 100%; left: 0; background: #1f2937; color: white; padding: 0.75rem 1rem; border-radius: 0.75rem; font-size: 0.8rem; white-space: nowrap; z-index: 30; transform: translateY(-10px); box-shadow: 0 10px 25px rgba(0, 0, 0, 0.25);">
                <span id="tooltip-text"></span>
                <button id="close-tooltip" class="ml-2 font-bold text-lg">&times;</button>
            </div>
            
            <button id="keyboardBtn" class="keyboard-btn" title="Toggle Keyboard">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                     <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                     <line x1="7" y1="7" x2="7" y2="7"></line><line x1="12" y1="7" x2="12" y2="7"></line><line x1="17" y1="7" x2="17" y2="7"></line>
                     <line x1="7" y1="12" x2="7" y2="12"></line><line x1="12" y1="12" x2="12" y2="12"></line><line x1="17" y1="12" x2="17" y2="12"></line>
                     <line x1="7" y1="17" x2="12" y2="17"></line>
                 </svg>
            </button>

            <!-- Voice Button -->
            <button id="voiceBtn" class="voice-btn" title="Voice Input">
                <svg id="mic-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 1C10.89 1 10 1.89 10 3V12C10 13.11 10.89 14 12 14C13.11 14 14 13.11 14 12V3C14 1.89 13.11 1 12 1Z" fill="currentColor"/>
                    <path d="M19 10V12C19 15.87 15.87 19 12 19C8.13 19 5 15.87 5 12V10H7V12C7 14.76 9.24 17 12 17C14.76 17 17 14.76 17 12V10H19Z" fill="currentColor"/>
                    <path d="M12 19V23H8V21H16V23H12V19Z" fill="currentColor"/>
                </svg>
            </button>
            
            <input type="text" id="messageInput" class="message-input">
            
            <button id="sendBtn" class="send-btn" title="Send Message">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2.01 21L23 12L2.01 3L2 10L17 12L2 14L2.01 21Z" fill="currentColor"/>
                </svg>
            </button>
        </footer>
    </div>
    
    <!-- Virtual Keyboard Container -->
    <div id="keyboard-container" class="keyboard-container">
        <div class="simple-keyboard"></div>
    </div>
    
    <script>
        // Sushruta - AI Health Assistant - Main JavaScript
        
        // --- IMPORTANT: For the app to work, you must replace this with your own Google AI API Key. ---
        // You can get a key from the Google AI Studio: https://makersuite.google.com/
        const apiKey = "AIzaSyDY4WUNKFyJmTDKZFCi0xZjLZvoMxsNTNo"; // If you want to use models other than gemini-2.5-flash-preview-05-20 or imagen-3.0-generate-002, provide an API key here. Otherwise, leave this as-is.
        
        const API_MODEL = "gemini-2.5-flash-preview-05-20";
        
        if (apiKey === "") {
            const errorElement = document.createElement('div');
            errorElement.style.cssText = 'position:fixed;top:0;left:0;width:100%;padding:1rem;background:red;color:white;text-align:center;font-weight:bold;z-index:1000;';
            errorElement.textContent = 'API Key is missing! Please add your API key to the script section in index.html to enable the assistant.';
            document.body.appendChild(errorElement);
        }

        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${API_MODEL}:generateContent?key=${apiKey}`;

        // --- DOM Elements ---
        const chatArea = document.getElementById('chatArea');
        const messageInput = document.getElementById('messageInput');
        const sendBtn = document.getElementById('sendBtn');
        const voiceBtn = document.getElementById('voiceBtn');
        const keyboardBtn = document.getElementById('keyboardBtn');
        const keyboardContainer = document.getElementById('keyboard-container');
        const typingIndicator = document.getElementById('typingIndicator');
        const initialMessageContainer = document.getElementById('initialMessageContainer');
        const voiceTooltip = document.getElementById('voice-tooltip');
        const closeTooltipBtn = document.getElementById('close-tooltip');
        const headerToggleBtn = document.getElementById('header-toggle-btn');
        const headerToggleIcon = document.getElementById('header-toggle-icon');
        const quickActions = document.getElementById('quick-actions');
        
        let currentLanguage = 'hi'; // Default language

        // --- Comprehensive Translations Object (Bug with duplicates fixed) ---
        const translations = {
            en: {
                disclaimer: "⚠️ Important: This is for assistance only. Consult a doctor for serious issues.",
                mainTitle: "Sushruta",
                subTitle: "Your Health Assistant",
                statFreeValue: "FREE",
                statFreeLabel: "Service",
                stat247Value: "24/7",
                stat247Label: "Available",
                quickBtnFever: "Fever",
                quickBtnCough: "Cough",
                quickBtnVaccine: "Vaccine",
                quickBtnStomach: "Stomach",
                quickBtnDiet: "Diet Plan",
                quickBtnMentalHealth: "Mental Health",
                quickBtnWomen: "Women Health",
                quickBtnEmergency: "Emergency",
                queryFever: "What are the symptoms of a fever?",
                queryCough: "How to treat a cough?",
                queryVaccine: "About child vaccinations",
                queryStomach: "Home remedies for stomach ache",
                queryDiet: "General advice for a healthy diet",
                queryMentalHealth: "How to improve mental well-being?",
                queryWomen: "Common women's health issues",
                queryEmergency: "I need emergency help",
                helpTitle: "<span>📚</span> How can I help you?",
                helpList: `• Know disease symptoms<br>• Get home remedies<br>• Learn about vaccination`,
                initialBotGreeting: "🙏 Hello! I'm Sushruta, your AI Health Assistant!",
                initialBotInstruction: "I can help with health issues. Use the buttons above or type your question.",
                typingText: "Sushruta is thinking...",
                inputPlaceholder: "Ask your question...",
                tooltipText: "🎤 Tap mic to speak",
                emergencyResponse: `🚨 **This sounds serious. Please seek immediate medical help.**<br><br>Call the National Emergency Number: <b>112</b><br>Or call for an Ambulance: <b>108</b>`,
                diseaseAlertTitle: "Health Alerts for Your Area",
                diseaseAlertDengueTitle: "Dengue Fever Cases Rising",
                diseaseAlertDengueInfo: "Prevent mosquito breeding by keeping surroundings clean and avoiding water stagnation.",
                diseaseAlertViralTitle: "Seasonal Viral Fever",
                diseaseAlertViralInfo: "Boost immunity with a healthy diet and stay hydrated. Consult a doctor if fever persists."
            },
            hi: {
                disclaimer: "⚠️ महत्वपूर्ण: यह केवल सहायता के लिए है। गंभीर समस्या के लिए डॉक्टर से मिलें।",
                mainTitle: "सुश्रुत",
                subTitle: "आपका स्वास्थ्य सहायक",
                statFreeValue: "मुफ्त",
                statFreeLabel: "सेवा",
                stat247Value: "24/7",
                stat247Label: "उपलब्ध",
                quickBtnFever: "बुखार",
                quickBtnCough: "खांसी",
                quickBtnVaccine: "टीका",
                quickBtnStomach: "पेट दर्द",
                quickBtnDiet: "आहार योजना",
                quickBtnMentalHealth: "मानसिक स्वास्थ्य",
                quickBtnWomen: "महिला स्वास्थ्य",
                quickBtnEmergency: "आपातकालीन",
                queryFever: "बुखार के लक्षण क्या हैं?",
                queryCough: "खांसी का इलाज कैसे करें?",
                queryVaccine: "बच्चों का टीकाकरण",
                queryStomach: "पेट दर्द का घरेलू इलाज",
                queryDiet: "स्वस्थ आहार के लिए सामान्य सलाह",
                queryMentalHealth: "मानसिक स्वास्थ्य कैसे सुधारें?",
                queryWomen: "महिलाओं की स्वास्थ्य समस्या",
                queryEmergency: "आपातकालीन मदद चाहिए",
                helpTitle: "<span>📚</span> मैं आपकी कैसे मदद कर सकता हूं?",
                helpList: `• बीमारी के लक्षण जानने के लिए<br>• घरेलू उपचार की जानकारी के लिए<br>• टीकाकरण की जानकारी के लिए`,
                initialBotGreeting: "🙏 नमस्ते! मैं सुश्रुत हूं, आपका AI स्वास्थ्य सहायक!",
                initialBotInstruction: "मैं आपकी स्वास्थ्य संबंधी समस्याओं में मदद कर सकता हूं। ऊपर के बटन दबाएं या अपना सवाल टाइप करें।",
                typingText: "सुश्रुत सोच रहा है...",
                inputPlaceholder: "अपना सवाल पूछें...",
                tooltipText: "🎤 माइक दबाकर बोलें",
                emergencyResponse: `🚨 **यह गंभीर लग रहा है। कृपया तत्काल चिकित्सा सहायता लें।**<br><br>राष्ट्रीय आपातकालीन नंबर पर कॉल करें: <b>112</b><br>या एम्बुलेंस के लिए कॉल करें: <b>108</b>`,
                diseaseAlertTitle: "आपके क्षेत्र के लिए स्वास्थ्य अलर्ट",
                diseaseAlertDengueTitle: "डेंगू बुखार के मामले बढ़ रहे हैं",
                diseaseAlertDengueInfo: "आस-पास साफ-सफाई रखकर और पानी जमा होने से रोककर मच्छरों के प्रजनन को रोकें।",
                diseaseAlertViralTitle: "मौसमी वायरल बुखार",
                diseaseAlertViralInfo: "स्वस्थ आहार से रोग प्रतिरोधक क्षमता बढ़ाएं और हाइड्रेटेड रहें। बुखार बना रहने पर डॉक्टर से सलाह लें।"
            },
            bn: {
                disclaimer: "⚠️ গুরুত্বপূর্ণ: এটি শুধুমাত্র সহায়তার জন্য। গুরুতর সমস্যার জন্য ডাক্তারের সাথে পরামর্শ করুন।",
                mainTitle: "সুশ্রুত",
                subTitle: "আপনার স্বাস্থ্য সহকারী",
                statFreeValue: "বিনামূল্যে",
                statFreeLabel: "পরিষেবা",
                stat247Value: "২৪/৭",
                stat247Label: "উপলব্ধ",
                quickBtnFever: "জ্বর",
                quickBtnCough: "কাশি",
                quickBtnVaccine: "টিকা",
                quickBtnStomach: "পেট ব্যথা",
                quickBtnDiet: "ডায়েট প্ল্যান",
                quickBtnMentalHealth: "মানসিক স্বাস্থ্য",
                quickBtnWomen: "মহিলাদের স্বাস্থ্য",
                quickBtnEmergency: "জরুরী",
                queryFever: "জ্বরের লক্ষণ কি?",
                queryCough: "কাশির চিকিৎসা কিভাবে করবেন?",
                queryVaccine: "শিশুদের টিকা সম্পর্কে",
                queryStomach: "পেট ব্যথার ঘরোয়া প্রতিকার",
                queryDiet: "স্বাস্থ্যকর খাবারের জন্য সাধারণ পরামর্শ",
                queryMentalHealth: "মানসিক সুস্থতা কীভাবে উন্নত করা যায়?",
                queryWomen: "মহিলাদের স্বাস্থ্য সমস্যা",
                queryEmergency: "জরুরী সাহায্য প্রয়োজন",
                helpTitle: "<span>📚</span> আমি কিভাবে আপনাকে সাহায্য করতে পারি?",
                helpList: `• রোগের লক্ষণ জানুন<br>• ঘরোয়া প্রতিকার পান<br>• টিকা সম্পর্কে জানুন`,
                initialBotGreeting: "🙏 নমস্কার! আমি সুশ্রুত, আপনার এআই স্বাস্থ্য সহকারী!",
                initialBotInstruction: "আমি স্বাস্থ্য সমস্যায় সাহায্য করতে পারি। উপরের বোতামগুলি ব্যবহার করুন বা আপনার প্রশ্ন টাইপ করুন।",
                typingText: "সুশ্রুত ভাবছে...",
                inputPlaceholder: "আপনার প্রশ্ন জিজ্ঞাসা করুন...",
                tooltipText: "🎤 কথা বলতে মাইক ট্যাপ করুন",
                emergencyResponse: `🚨 **এটি গুরুতর মনে হচ্ছে। অনুগ্রহ করে অবিলম্বে চিকিৎসা সহায়তা নিন।**<br><br>জাতীয় জরুরি নম্বর এ কল করুন: <b>112</b><br>অথবা অ্যাম্বুলেন্সের জন্য কল করুন: <b>108</b>`,
                diseaseAlertTitle: "আপনার এলাকার জন্য স্বাস্থ্য সতর্কতা",
                diseaseAlertDengueTitle: "ডেঙ্গু জ্বরের ঘটনা বাড়ছে",
                diseaseAlertDengueInfo: "পরিবেশ পরিষ্কার রেখে এবং জল জমতে না দিয়ে মশার বংশবৃদ্ধি রোধ করুন।",
                diseaseAlertViralTitle: "মৌসুমী ভাইরাল জ্বর",
                diseaseAlertViralInfo: "স্বাস্থ্যকর খাবারের মাধ্যমে রোগ প্রতিরোধ ক্ষমতা বাড়ান এবং হাইড্রেটেড থাকুন। জ্বর থাকলে ডাক্তারের সাথে পরামর্শ করুন।"
            },
            ta: {
                disclaimer: "⚠️ முக்கியம்: இது உதவிக்கு மட்டுமே. গুরুতর பிரச்சினைகளுக்கு மருத்துவரை அணுகவும்.",
                mainTitle: "சுஷ்ருதா",
                subTitle: "உங்கள் சுகாதார உதவியாளர்",
                statFreeValue: "இலவசம்",
                statFreeLabel: "சேவை",
                stat247Value: "24/7",
                stat247Label: "கிடைக்கும்",
                quickBtnFever: "காய்ச்சல்",
                quickBtnCough: "இருமல்",
                quickBtnVaccine: "தடுப்பூசி",
                quickBtnStomach: "வயிற்று வலி",
                quickBtnDiet: "உணவு திட்டம்",
                quickBtnMentalHealth: "மனநலம்",
                quickBtnWomen: "பெண்கள் நலம்",
                quickBtnEmergency: "அவசரம்",
                queryFever: "காய்ச்சலின் அறிகுறிகள் என்ன?",
                queryCough: "இருமல் குணப்படுத்துவது எப்படி?",
                queryVaccine: "குழந்தை தடுப்பூசிகள் பற்றி",
                queryStomach: "வயிற்று வலிக்கான வீட்டு வைத்தியம்",
                queryDiet: "ஆரோக்கியமான உணவுக்கான பொதுவான ஆலோசனை",
                queryMentalHealth: "மன நலத்தை எவ்வாறு மேம்படுத்துவது?",
                queryWomen: "பெண்களின் சுகாதார பிரச்சினைகள்",
                queryEmergency: "எனக்கு அவசர உதவி தேவை",
                helpTitle: "<span>📚</span> நான் உங்களுக்கு எப்படி உதவ முடியும்?",
                helpList: `• நோய் அறிகுறிகளை அறியுங்கள்<br>• வீட்டு வைத்தியம் பெறுங்கள்<br>• தடுப்பூசி பற்றி அறியுங்கள்`,
                initialBotGreeting: "🙏 வணக்கம்! நான் சுஷ்ருதா, உங்கள் AI சுகாதார உதவியாளர்!",
                initialBotInstruction: "சுகாதார பிரச்சினைகளுக்கு நான் உதவ முடியும்। மேலே உள்ள பொத்தான்களைப் பயன்படுத்தவும் அல்லது உங்கள் கேள்வியை தட்டச்சு செய்யவும்।",
                typingText: "சுஷ்ருதா யோசிக்கிறது...",
                inputPlaceholder: "உங்கள் கேள்வியைக் கேளுங்கள்...",
                tooltipText: "🎤 பேச மைக்கைத் தட்டவும்",
                emergencyResponse: `🚨 **இது தீவிரமாகத் தெரிகிறது. உடனடியாக மருத்துவ உதவியை நாடுங்கள்.**<br><br>தேசிய அவசர எண்ணை அழைக்கவும்: <b>112</b><br>அல்லது ஆம்புலன்ஸை அழைக்கவும்: <b>108</b>`,
                diseaseAlertTitle: "உங்கள் பகுதிக்கான சுகாதார எச்சரிக்கைகள்",
                diseaseAlertDengueTitle: "டெங்கு காய்ச்சல் ಪ್ರಕರಣங்கள் அதிகரித்து வருகின்றன",
                diseaseAlertDengueInfo: "சுற்றுப்புறத்தை சுத்தமாக வைத்திருப்பதன் மூலமும், தண்ணீர் தேங்குவதைத் தவிர்ப்பதன் மூலமும் கொசுக்கள் பெருகுவதைத் தடுக்கவும்.",
                diseaseAlertViralTitle: "பருவகால வைரஸ் காய்ச்சல்",
                diseaseAlertViralInfo: "ஆரோக்கியமான உணவு மூலம் நோய் எதிர்ப்பு சக்தியை அதிகரித்து, நீரேற்றத்துடன் இருங்கள். காய்ச்சல் தொடர்ந்தால் மருத்துவரை அணுகவும்."
            },
            od: {
                disclaimer: "⚠️ ଗୁରୁତ୍ୱପୂର୍ଣ୍ଣ: ଏହା କେବଳ ସହାୟତା ପାଇଁ। ଗମ୍ଭୀର ସମସ୍ୟା ପାଇଁ ଡାକ୍ତରଙ୍କ ସହିତ ପରାମର୍ଶ କରନ୍ତୁ।",
                mainTitle: "ସୁଶ୍ରୁତ",
                subTitle: "ଆପଣଙ୍କ ସ୍ୱାସ୍ଥ୍ୟ ସହାୟକ",
                statFreeValue: "ମାଗଣା",
                statFreeLabel: "ସେବା",
                stat247Value: "୨୪/୭",
                stat247Label: "ଉପଲବ୍ଧ",
                quickBtnFever: "ଜ୍ୱର",
                quickBtnCough: "କାଶ",
                quickBtnVaccine: "ଟିକା",
                quickBtnStomach: "ପେଟ ବ୍ୟଥା",
                quickBtnDiet: "ଡାଏଟ୍ ପ୍ଲାନ୍",
                quickBtnMentalHealth: "ମାନସିକ ସ୍ୱାସ୍ଥ୍ୟ",
                quickBtnWomen: "ମହିଳା ସ୍ୱାସ୍ଥ୍ୟ",
                quickBtnEmergency: "ଜରୁରୀକାଳୀନ",
                queryFever: "ଜ୍ୱରର ଲକ୍ଷଣ କ'ଣ?",
                queryCough: "କାଶର ଚିକିତ୍ସା କିପରି କରିବେ?",
                queryVaccine: "ଶିଶୁ ଟୀକାକରଣ ବିଷୟରେ",
                queryStomach: "ପେଟ ବ୍ୟଥା ପାଇଁ ଘରୋଇ ଉପଚାର",
                queryDiet: "ଏକ ସୁସ୍ଥ ଖାଦ୍ୟ ପାଇଁ ସାଧାରଣ ପରାମର୍ଶ",
                queryMentalHealth: "ମାନସିକ ସୁସ୍ଥତା କିପରି ଉନ୍ନତ କରିବେ?",
                queryWomen: "ମହିଳାଙ୍କ ସ୍ୱାସ୍ଥ୍ୟ ସମସ୍ୟା",
                queryEmergency: "ମୋତେ ଜରୁରୀକାଳୀନ ସାହାଯ୍ୟ ଦରକାର",
                helpTitle: "<span>📚</span> ମୁଁ ଆପଣଙ୍କୁ କିପରି ସାହାଯ୍ୟ କରିପାରେ?",
                helpList: `• ରୋଗର ଲକ୍ଷଣ ଜାଣନ୍ତୁ<br>• ଘରୋଇ ଉପଚାର ପାଆନ୍ତୁ<br>• ଟୀକାକରଣ ବିଷୟରେ ଜାଣନ୍ତୁ`,
                initialBotGreeting: "🙏 ନମସ୍କାର! ମୁଁ ସୁଶ୍ରୁତ, ଆପଣଙ୍କ AI ସ୍ୱାସ୍ଥ୍ୟ ସହାୟକ!",
                initialBotInstruction: "ମୁଁ ସ୍ୱାସ୍ଥ୍ୟ ସମସ୍ୟାରେ ସାହାଯ୍ୟ କରିପାରିବି। ଉପର ବଟନ୍ ବ୍ୟବହାର କରନ୍ତୁ କିମ୍ବା ଆପଣଙ୍କ ପ୍ରଶ୍ନ ଟାଇପ୍ କରନ୍ତୁ।",
                typingText: "ସୁଶ୍ରୁତ ଭାବୁଛି...",
                inputPlaceholder: "ଆପଣଙ୍କ ପ୍ରଶ୍ନ ପଚାରନ୍ତୁ...",
                tooltipText: "🎤 କହିବା ପାଇଁ ମାଇକ୍ ଟ୍ୟାପ୍ କରନ୍ତୁ",
                emergencyResponse: `🚨 **ଏହା ଗମ୍ଭୀର ମନେହେଉଛି। ଦୟାକରି ତୁରନ୍ତ ଡାକ୍ତରୀ ସାହାଯ୍ୟ ନିଅନ୍ତୁ।**<br><br>ଜାତୀୟ ଜରୁରୀକାଳୀନ ନମ୍ବରକୁ କଲ୍ କରନ୍ତୁ: <b>112</b><br>କିମ୍ବା ଆମ୍ବୁଲାନ୍ସ ପାଇଁ କଲ୍ କରନ୍ତୁ: <b>108</b>`,
                diseaseAlertTitle: "ଆପଣଙ୍କ ଅଞ୍ଚଳ ପାଇଁ ସ୍ୱାସ୍ଥ୍ୟ ସତର୍କତା",
                diseaseAlertDengueTitle: "ଡେଙ୍ଗୁ ଜ୍ୱର ମାମଲା ବଢୁଛି",
                diseaseAlertDengueInfo: "ପରିବେଶକୁ ସଫା ରଖି ଏବଂ ପାଣି ଜମିବାକୁ ନ ଦେଇ ମଶାଙ୍କ ବଂଶବୃଦ୍ଧିକୁ ରୋକନ୍ତୁ।",
                diseaseAlertViralTitle: "ଋତୁକାଳୀନ ଭାଇରାଲ୍ ଜ୍ୱର",
                diseaseAlertViralInfo: "ଏକ ସୁସ୍ଥ ଖାଦ୍ୟ ସହିତ ରୋଗ ପ୍ରତିରୋଧକ ଶକ୍ତି ବଢାନ୍ତୁ ଏବଂ ହାଇଡ୍ରେଟେଡ୍ ରୁହନ୍ତୁ। ଯଦି ଜ୍ୱର ଲାଗିରହେ ତେବେ ଡାକ୍ତରଙ୍କ ସହିତ ପରାମର୍ଶ କରନ୍ତୁ।"
            },
            te: {
                disclaimer: "⚠️ ముఖ్య గమనిక: ఇది సహాయం కోసం మాత్రమే. తీవ్రమైన సమస్యల కోసం వైద్యుడిని సంప్రదించండి.",
                mainTitle: "సుశ్రుత",
                subTitle: "మీ ఆరోగ్య సహాయకుడు",
                statFreeValue: "ఉచితం",
                statFreeLabel: "సేవ",
                stat247Value: "24/7",
                stat247Label: "అందుబాటులో ఉంది",
                quickBtnFever: "జ్వరం",
                quickBtnCough: "దగ్గు",
                quickBtnVaccine: "టీకా",
                quickBtnStomach: "కడుపు నొప్పి",
                quickBtnDiet: "ఆహార ప్రణాళిక",
                quickBtnMentalHealth: "మానసిక ఆరోగ్యం",
                quickBtnWomen: "మహిళల ఆరోగ్యం",
                quickBtnEmergency: "అత్యవసరం",
                queryFever: "జ్వరం యొక్క లక్షణాలు ఏమిటి?",
                queryCough: "దగ్గును ఎలా తగ్గించాలి?",
                queryVaccine: "పిల్లల టీకాల గురించి",
                queryStomach: "కడుపు నొప్పికి ఇంటి నివారణలు",
                queryDiet: "ఆరోగ్యకరమైన ఆహారం కోసం సాధారణ సలహా",
                queryMentalHealth: "మానసిక క్షేమాన్ని ఎలా మెరుగుపరచుకోవాలి?",
                queryWomen: "మహిళల సాధారణ ఆరోగ్య సమస్యలు",
                queryEmergency: "నాకు అత్యవసర సహాయం కావాలి",
                helpTitle: "<span>📚</span> నేను మీకు ఎలా సహాయపడగలను?",
                helpList: `• వ్యాధి లక్షణాలను తెలుసుకోండి<br>• ఇంటి నివారణలను పొందండి<br>• టీకాల గురించి తెలుసుకోండి`,
                initialBotGreeting: "🙏 నమస్కారం! నేను సుశ్రుత, మీ AI ఆరోగ్య సహాయకుడిని!",
                initialBotInstruction: "నేను ఆరోగ్య సమస్యలతో సహాయపడగలను. పై బటన్లను ఉపయోగించండి లేదా మీ ప్రశ్నను టైప్ చేయండి.",
                typingText: "సుశ్రుత ఆలోచిస్తోంది...",
                inputPlaceholder: "మీ ప్రశ్నను అడగండి...",
                tooltipText: "🎤 మాట్లాడటానికి మైక్‌ను నొక్కండి",
                emergencyResponse: `🚨 **ఇది తీవ్రంగా ఉంది. దయచేసి తక్షణ వైద్య సహాయం తీసుకోండి.**<br><br>జాతీయ అత్యవసర నంబర్‌కు కాల్ చేయండి: <b>112</b><br>లేదా అంబులెన్స్ కోసం కాల్ చేయండి: <b>108</b>`,
                diseaseAlertTitle: "మీ ప్రాంతానికి ఆరోగ్య హెచ్చరికలు",
                diseaseAlertDengueTitle: "డెంగ్యూ జ్వరం కేసులు పెరుగుతున్నాయి",
                diseaseAlertDengueInfo: "పరిసరాలను శుభ్రంగా ఉంచడం మరియు నీరు నిలిచిపోకుండా చూడటం ద్వారా దోమల వ్యాప్తిని నివారించండి.",
                diseaseAlertViralTitle: "సీజనల్ వైరల్ జ్వరం",
                diseaseAlertViralInfo: "ఆరోగ్యకరమైన ఆహారంతో రోగనిరోధక శక్తిని పెంచుకోండి మరియు హైడ్రేటెడ్‌గా ఉండండి. జ్వరం తగ్గకపోతే వైద్యుడిని సంప్రదించండి."
            }
        };

        // --- UI Update Function ---
        function updateUIText(lang) {
            const t = translations[lang] || translations.en; // Fallback to English

            // Update Header
            document.getElementById('disclaimer-banner').innerText = t.disclaimer;
            document.getElementById('main-title').innerText = t.mainTitle;
            document.getElementById('sub-title').innerText = t.subTitle;
            document.getElementById('stat-free-value').innerText = t.statFreeValue;
            document.getElementById('stat-free-label').innerText = t.statFreeLabel;
            document.getElementById('stat-247-value').innerText = t.stat247Value;
            document.getElementById('stat-247-label').innerText = t.stat247Label;

            // Update Quick Actions
            const quickButtons = [
                { id: 'quick-btn-fever', icon: '🌡️', text: t.quickBtnFever, query: t.queryFever },
                { id: 'quick-btn-cough', icon: '😤', text: t.quickBtnCough, query: t.queryCough },
                { id: 'quick-btn-vaccine', icon: '💉', text: t.quickBtnVaccine, query: t.queryVaccine },
                { id: 'quick-btn-stomach', icon: '🤢', text: t.quickBtnStomach, query: t.queryStomach },
                { id: 'quick-btn-diet', icon: '🥗', text: t.quickBtnDiet, query: t.queryDiet },
                { id: 'quick-btn-mental-health', icon: '🧠', text: t.quickBtnMentalHealth, query: t.queryMentalHealth },
                { id: 'quick-btn-women', icon: '👩‍⚕️', text: t.quickBtnWomen, query: t.queryWomen },
                { id: 'quick-btn-emergency', icon: '🚨', text: t.quickBtnEmergency, query: t.queryEmergency },
            ];
            
            quickButtons.forEach(btnInfo => {
                const btnElement = document.getElementById(btnInfo.id);
                btnElement.innerHTML = `<span class="icon">${btnInfo.icon}</span><span>${btnInfo.text}</span>`;
                btnElement.dataset.query = btnInfo.query;
            });

            // Update Disease Alert
            document.getElementById('disease-alert-title').innerText = t.diseaseAlertTitle;
            document.getElementById('disease-alert-content').innerHTML = `
                <p><strong>${t.diseaseAlertDengueTitle}:</strong> ${t.diseaseAlertDengueInfo}</p>
                <p><strong>${t.diseaseAlertViralTitle}:</strong> ${t.diseaseAlertViralInfo}</p>
            `;

            // Update Initial Message Area
            initialMessageContainer.innerHTML = `
                <div class="help-section">
                    <div class="help-title" id="help-title">${t.helpTitle}</div>
                    <div class="help-list" id="help-list">${t.helpList}</div>
                </div>
                <div class="message bot-message fade-in">
                    <p class="font-bold text-gray-800 mb-3">${t.initialBotGreeting}</p>
                    <p class="text-gray-600">${t.initialBotInstruction}</p>
                </div>`;

            // Update other elements
            document.getElementById('typing-text').innerText = t.typingText;
            messageInput.placeholder = t.inputPlaceholder;
            document.getElementById('tooltip-text').innerText = t.tooltipText;
        }


        // --- Event Listeners ---
        window.addEventListener('load', () => {
            updateUIText(currentLanguage); // Set initial language on load
            initKeyboard(); // Initialize virtual keyboard
        });

        document.getElementById('close-alert-btn').addEventListener('click', () => {
            const banner = document.getElementById('disease-alert');
            banner.style.maxHeight = '0';
            banner.style.paddingTop = '0';
            banner.style.paddingBottom = '0';
            banner.style.marginTop = '0';
            banner.style.marginBottom = '0';
            banner.style.borderWidth = '0';
            banner.style.opacity = '0';
        });

        sendBtn.addEventListener('click', sendMessage);
        messageInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                sendMessage();
            }
        });
        document.querySelectorAll('.quick-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                messageInput.value = btn.dataset.query;
                sendMessage();
            });
        });
        voiceBtn.addEventListener('click', toggleVoiceRecognition);
        closeTooltipBtn.addEventListener('click', () => voiceTooltip.classList.add('hidden'));
        headerToggleBtn.addEventListener('click', () => {
            document.getElementById('disease-alert').classList.toggle('collapsed');
            quickActions.classList.toggle('collapsed');
            headerToggleIcon.classList.toggle('rotate-180');
        });


        // --- Core Functions ---
        function sendMessage() {
            const userMessage = messageInput.value.trim();
            if (!userMessage || apiKey === "PASTE_YOUR_GOOGLE_AI_API_KEY_HERE") return;

            if (initialMessageContainer.style.display !== 'none') {
                initialMessageContainer.style.display = 'none';
            }

            addMessage(userMessage, 'user');
            messageInput.value = '';
            if (keyboard) {
                keyboard.setInput(""); // Clear keyboard input
            }
            showTypingIndicator(true);
            
            if (isEmergency(userMessage)) {
                const emergencyResponse = getEmergencyResponse(currentLanguage);
                setTimeout(() => {
                    showTypingIndicator(false);
                    addMessage(marked.parse(emergencyResponse), 'bot');
                }, 1000);
            } else {
                callGeminiAPI(userMessage);
            }
        }

        async function callGeminiAPI(prompt) {
            try {
                // Enhanced system prompt for better, safer, and more empathetic responses
                const systemPrompt = `You are Sushruta, an AI health assistant for India. Your primary goal is to provide helpful, safe, and preliminary health information in a calm, empathetic, and reassuring tone. You must respond ONLY in the user's selected language: ${currentLanguage}.

                **CRITICAL SAFETY INSTRUCTIONS:**
                1.  **ALWAYS start your response with a clear disclaimer:** "⚠️ **Disclaimer:** This is for informational purposes only and not a substitute for professional medical advice. Please consult a doctor for any health concerns." (Translate this disclaimer accurately to the user's language).
                2.  **NEVER provide a diagnosis.** You can list possible symptoms or causes, but you must never state what condition the user has. Frame suggestions carefully, e.g., "Some people find relief by..."
                3.  **FOR ANY SERIOUS SYMPTOMS** (e.g., chest pain, difficulty breathing, severe bleeding, high fever in infants, confusion, sudden weakness), immediately advise the user to seek emergency medical help. Provide the national emergency number (112) and ambulance number (108).
                4.  **KEEP INFORMATION GENERAL.** Avoid specific dosages for medications. Recommend consulting a doctor or pharmacist for treatment plans and medication advice.
                5.  **USE SIMPLE LANGUAGE.** Avoid complex medical jargon. Explain concepts clearly and concisely.

                **CONTENT & FORMATTING GUIDELINES:**
                - **Use Markdown for formatting.** Use headings, bold text, and bulleted lists (\`*\` or \`-\`) to structure information and make it easy to read.
                - **Use emojis** to make the content more friendly and approachable (e.g., 🩺, 🙏, 😊, 🥗).
                - **Structure your response clearly:**
                    1.  Mandatory Disclaimer (Translated).
                    2.  Empathetic acknowledgment of the user's query.
                    3.  Clear, structured answer using Markdown.
                    4.  Actionable, safe recommendations (e.g., "Consider speaking to a doctor," "You might find it helpful to...").

                **NEW INSTRUCTION: PROVIDING DOCTOR INFORMATION**
                After you provide the health information for the user's query, you MUST add a new section titled "### 🩺 Find a Specialist (Examples)".
                In this section, you must:
                1.  Identify the relevant medical specialty for the user's query (e.g., for a skin rash, the specialty is Dermatology; for a heart issue, it's Cardiology; for fever or cold, it is General Medicine).
                2.  Search the "INTERNAL KNOWLEDGE BASE" provided below for doctors or departments matching that specialty.
                3.  List a few relevant examples of doctors or departments you find. Include their name, designation, and hospital.
                4.  **CRITICALLY IMPORTANT:** You MUST include the following disclaimer at the end of this section: "Please note: This is a sample list based on publicly available data and may not be current or complete. Please contact the hospital directly to confirm doctor availability and book an appointment." (Translate this disclaimer to the user's language).
                5.  If you cannot find a relevant specialist in the knowledge base, state that you don't have specific doctor information for this condition and recommend contacting a major government hospital for a referral.

                ---

                **INTERNAL KNOWLEDGE BASE: DOCTOR DIRECTORY (SAMPLE DATA)**

                **1. Nil Ratan Sircar (NRS) Medical College & Hospital, Kolkata, West Bengal (Heads of Departments)**
                - Anaesthesiology: Dr. Dipankar Mukherjee
                - Anatomy: Dr. Sudeshna Majumdar
                - Biochemistry: Dr. Indranil Dawn
                - Cardiac Anaesthesiology: Dr. Sampa Dutta Gupta
                - Cardio Thoracic & Vascular Surgery: Dr. Binay Krishna Sarkar
                - Cardiology: Prof. (Dr.) Manoranjan Mandal
                - Community Medicine: Dr. Dibakar Haldar
                - Dentistry: Dr. Subhas Chakraborty
                - Dermatology: Dr. Arun Achar
                - Endocrinology: Dr. Nilanjan Sengupta
                - Forensic Medicine & Toxicology: Dr. Saurabh Chattopadhyay
                - Gastroenterology: Dr. Manas Kumar Mondal
                - General Medicine: Dr. Milan Chakraborty
                - General Surgery: Dr. Sankar Das Chattopadhyay
                - Gynecology & Obstetrics: Dr. Runa Bal
                - Haematology: Dr. Tuphan Kanti Dolai
                - Microbiology: Prof. (Dr) Jayanta Bikash Dey
                - Nephrology: Dr. Pinaki Mukhopadhyay
                - Neuro Surgery: Dr. Kaushik Roy
                - Neurology: Prof. (Dr) Kartik Chandra Ghosh
                - Ophthalmology: Dr. Udayaditya Mukhopadhyay
                - Orthopedics: Dr. Gopinath Maiti
                - Otorhinolaryngology (ENT): Dr. Sumanta Kumar Dutta
                - Paediatric Surgery: Dr. Kalyani Saha Basu
                - Paediatrics Medicine: Dr. Asim Kr Mallick
                - Pathology: Dr. Gopinath Barui
                - Pharmacology: Dr. Pragnadyuti Mandal
                - Physical Medicine & Rehabilitation: Dr. Partha Pratim Das
                - Physiology: Dr. Suranjana Sur Mukherjee
                - Plastic Surgery: Dr. Dibyendu Das
                - Psychiatry: Dr. Asish Mukhopadhyay
                - Radio Diagnosis: Dr. Runa Das
                - Radio Therapy (Radiation Oncology): Dr. Suman Ghorai
                - Respiratory Medicine: Dr. Jaydip Deb
                - Urology: Dr. Tapan Kumar Mandal

                **2. Sheikh Bhikhari Medical College & Hospital, Hazaribag, Jharkhand**
                - **Medicine:** DR S K SINGH (Professor & Principal), DR S. K. SINHA (Professor & HOD), DR SMITA PRIYADARSHINI (Assistant Professor), DR HIMANSHU KR. BHAIYA (Assistant Professor), DR SOMA ORAON (Assistant Professor), DR ANIL KUMAR (Assistant Professor).
                - **Surgery:** DR VINOD KUMAR (Professor), DR OM PRAKASH SRIVASTAVA (Associate Professor), DR A. K. CHOUDHARY (Associate Professor), DR GAUTAM CHANDRA DR ABHISHEK KUMAR (Assistant Professor), DR UTKRISHT KANT (Assistant Professor), DR SUMEGHA RANA (Assistant Professor), DR ANJANA GANDHI DR VIVEK BHASKER (Assistant Professor), DR MRIGENDRA RAI (Assistant Professor).
                - **Obstetrics & Gynecology (OBGY):** DR SWETA LAL (Assistant Professor), Dr Rameshwari Beck (Assistant Professor).
                - **Eye (Ophthalmology):** DR K. K. LAL (Professor).
                - **Ear, Nose, and Throat (ENT):** DR PRADEEP KUMAR SINGGH (Professor), Dr. RAKHI KUMARI (Assistant Professor).
                - **Paediatrics:** DR CHITIZ ANAND (Assistant Professor).
                - **Skin & VD (Dermatology):** DR. FIRDOUS JAHAN (Assistant Professor).
                - **Orthopaedics:** DR. PAWAN KUMAR (Professor), DR RUPESH KUMAR (Associate Professor), DR. SHANKAR NIWAS (Assistant Professor), DR SHASHI KANT SINGH (Assistant Professor).
                - **Anaesthesia:** DR. SHASHI DINKAR MINZ (Professor), DR. SANJEEV KUMAR (Associate Professor), DR. PIYUSH KUMAR SENGAR (Assistant Professor), DR INDRAJIT GUPTA (Assistant Professor).
                - **Psychiatry:** DR. RAJSHREE (Assistant Professor), DR SHAHANAWAJ ZAFAR (Assistant Professor).
                - **Dentistry:** DR KOYNA MITRA (Professor), DR RATHORE DHANANJAY GOVIND SINGH (Associate Professor).

                **3. MKCG Medical College & Hospital, Berhampur, Odisha**
                - **Anaesthesiology:** Dr. Harikrishna Dalai (Professor), Prof Dr Khageswar Raut (Professor), Dr. Jyoshna Mishra (Professor), Dr. Bimal Prasad Sahu (Associate Professor), Dr. S Sanjeeb Patro (Associate Professor), Dr. Bishnu Prasad Mohapatra (Associate Professor), Dr. Siba Prasad Das (Associate Professor), Dr. Bipin Bihari Malik (Assistant Professor), Dr. Manas Kumar Nahak (Assistant Professor), Dr. Nibedita Patnaik (Assistant Professor), Dr. Pankaj Kumar Sethy (Assistant Professor), Dr. Anup Kumar Harichandan (Assistant Professor), Dr. Chittranjan Pradhan (Assistant Professor), Dr. Jagdeep Nayak (Assistant Professor), Dr. Kunal Patra (Assistant Professor), Dr. Mrutyunjaya Mallick (Assistant Professor), Dr. Jayanta Pattanaik (Assistant Professor).`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    systemInstruction: {
                        parts: [{ text: systemPrompt }]
                    },
                };

                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API call failed with status: ${response.status}`);
                }

                const result = await response.json();
                const botResponse = result.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I couldn't process that. Could you try rephrasing?";
                
                // Parse the Markdown response to HTML
                addMessage(marked.parse(botResponse), 'bot');

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                addMessage("I'm having trouble connecting right now. Please try again later.", 'bot');
            } finally {
                showTypingIndicator(false);
            }
        }

        function addMessage(text, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.innerHTML = text; // Use innerHTML directly as text is now parsed HTML
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator(show) {
            typingIndicator.style.display = show ? 'flex' : 'none';
            if (show) {
                chatArea.scrollTop = chatArea.scrollHeight;
            }
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`lang-${lang}`).classList.add('active');
            updateUIText(lang);
            // Update keyboard layout
            if (keyboard) {
                keyboard.setOptions({
                    layout: keyboardLayouts[lang],
                    layoutName: 'default' // Reset to default layout on language change
                });
            }
        }

        // --- Voice Recognition ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;
        let isListening = false;
        
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            
            recognition.onstart = () => {
                isListening = true;
                voiceBtn.classList.add('listening');
            };
            
            recognition.onend = () => {
                isListening = false;
                voiceBtn.classList.remove('listening');
            };
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                messageInput.value = transcript;
                sendMessage();
            };
            
            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
            };

        } else {
            voiceBtn.style.display = 'none'; // Hide voice button if not supported
        }

        function toggleVoiceRecognition() {
            if (!recognition) return;
            
            if (isListening) {
                recognition.stop();
            } else {
                recognition.lang = getLangCodeForVoice(currentLanguage);
                recognition.start();
            }
        }
        
        function getLangCodeForVoice(lang) {
            const langMap = {
                'en': 'en-IN',
                'hi': 'hi-IN',
                'bn': 'bn-IN',
                'ta': 'ta-IN',
                'od': 'or-IN',
                'te': 'te-IN'
            };
            return langMap[lang] || 'en-IN';
        }
        
        // --- Emergency Detection ---
        function isEmergency(text) {
            const emergencyKeywords = [
                // English
                'chest pain', 'heart attack', 'stroke', 'can\'t breathe', 'not breathing', 'severe bleeding', 'unconscious', 'poison', 'suicide', 'emergency', 'accident', 'seizure',
                // Hindi (and other regional languages)
                'छाती में दर्द', 'दिल का दौरा', 'लकवा', 'सांस नहीं ले पा रहा', 'बेहोश', 'गंभीर रक्तस्राव', 'जहर', 'आत्महत्या', 'आपातकालीन', 'दुर्घटना'
            ];
            const lowerText = text.toLowerCase();
            return emergencyKeywords.some(keyword => lowerText.includes(keyword));
        }

        function getEmergencyResponse(lang) {
            const t = translations[lang] || translations.en;
            return t.emergencyResponse;
        }

        // Show voice tooltip on first visit
        if (!localStorage.getItem('visitedSushruta')) {
            setTimeout(() => {
                voiceTooltip.classList.remove('hidden');
            }, 2000);
            localStorage.setItem('visitedSushruta', 'true');
        }

        // --- Virtual Keyboard Logic ---
        const Keyboard = window.SimpleKeyboard.default;
        let keyboard;
        const languageCycle = ['en', 'hi', 'bn', 'ta', 'od', 'te'];

        const keyboardLayouts = {
            en: {
                'default': [
                    'q w e r t y u i o p', 'a s d f g h j k l', '{shift} z x c v b n m {backspace}', '{next} {space} {hide} {enter}'
                ],
                'shift': [
                    'Q W E R T Y U I O P', 'A S D F G H J K L', '{shift} Z X C V B N M {backspace}', '{next} {space} {hide} {enter}'
                ]
            },
            hi: {
                'default': [
                    'ौ ै ा ी ू ू े ो ् ृ {backspace}',
                    'त थ द ध न प फ ब भ म',
                    'य र ल व श ष स ह च छ ज झ',
                    'क़ ख ग़ ज़ ड़ ढ़ फ़ य़ ॉ ञ',
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'औ ऐ आ ई ऊ ब भ र् ज्ञ ऋ ॐ',
                    'त् थ् द् ध् न् प् फ् ब् भ् म्',
                    'य् र् ल् व् श् ष् स् ह् च् छ् ज् झ्',
                    'ट ठ ड ढ ण क ख ग घ ङ ञ्',
                    '{shift} {next} {space} {hide} {enter}'
                ]
            },
            bn: {
                'default': [
                    'ৌ ৈ া ী ু ূ ে ো ্ ৃ {backspace}',
                    'ত থ দ ধ ন প ফ ব ভ ম',
                    'য র ল ব শ ষ স হ চ ছ জ ঝ ঞ',
                    'ট ঠ ড ঢ ণ ক খ গ ঘ ঙ',
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'ঔ ঐ অ ই উ ঊ ঋ এ ঐ ও ঔ',
                    'ৎ থ্ দ্ ধ্ ন্ প্ ফ্ ব্ ভ্ ম্',
                    'য্ র ্ ল্ ব্ শ্ ষ ্ স্ হ্ চ্ ছ্ জ্ ঝ্ ঞ্',
                    'ট্ ঠ্ ড্ ঢ্ ণ্ ক্ খ্ গ্ ঘ্ ঙ্',
                    '{shift} {next} {space} {hide} {enter}'
                ]
            },
            ta: {
                'default': [
                    'க ச ட த ப ய ர ல வ ழ ள {backspace}', 
                    'அ ஆ இ ஈ உ ஊ எ ஏ ஐ ஒ ஓ ஔ', 
                    '் ா ி ீ ு ூ ெ ே ை ொ ோ ௌ ஃ', 
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'ங ஞ ண ந ம ன ற ன', 
                    'க் ச் ட் த் ப் ய் ர் ல் வ் ழ் ள்', 
                    'ஜ் ஷ் ஸ் ஹ் ஸ்ரீ {backspace}', 
                    '{shift} {next} {space} {hide} {enter}'
                ]
            },
             od: {
                'default': [
                    'ୌ ୈ ା ୀ ୂ ୄ େ ୋ ୍ ୃ {backspace}',
                    'ତ ଥ ଦ ଧ ନ ପ ଫ ବ ଭ ମ',
                    'ଯ ର ଲ ଵ ଶ ଷ ସ ହ ଚ ଛ ଜ ଝ ଞ',
                    'ଟ ଠ ଡ ଢ ଣ କ ଖ ଗ ଘ ଙ',
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'ଔ ঐ ଆ ଈ ଉ ଊ ଋ ଏ ଓ ଔ',
                    'ତ୍ ଥ୍ ଦ୍ ଧ୍ ନ ପ୍ ଫ୍ ବ୍ ଭ୍ ମ୍',
                    'ଯ୍ ର୍ ଲ୍ ଵ୍ ଶ୍ ଷ୍ ସ୍ ହ୍ ଚ୍ ଛ୍ ଜ୍ ଝ୍ ଞ୍',
                    'ଟ୍ ଠ୍ ଡ୍ ଢ୍ ଣ କ୍ ଖ୍ ଗ୍ ଘ୍ ଙ୍',
                    '{shift} {next} {space} {hide} {enter}'
                ]
            },
            te: {
                 'default': [
                    'ౌ ై ా ీ ు ూ ె ో ్ ృ {backspace}',
                    'త థ ద ధ న ప ఫ బ భ మ',
                    'య ర ల వ శ ష స హ చ ఛ జ ఝ ఞ',
                    'ట ఠ డ ఢ ణ క ఖ గ ఘ ఙ',
                    '{shift} {next} {space} {hide} {enter}'
                ],
                'shift': [
                    'ఔ ఐ ఆ ఈ ఉ ఊ ఋ ఎ ఏ ఒ ఓ',
                    'త్ థ్ ద్ ధ్ న ప్ ఫ్ బ్ భ్ మ్',
                    'య్ ర్ ల వ శ ష స హ చ ఛ జ ఝ ఞ',
                    'ట్ ఠ్ డ్ ఢ్ ణ్ క్ ఖ్ గ్ ఘ్ ఙ్',
                    '{shift} {next} {space} {hide} {enter}'
                ]
            }
        };

        function initKeyboard() {
            keyboard = new Keyboard({
                onChange: input => onKeyboardChange(input),
                onKeyPress: button => onKeyPress(button),
                layoutName: "default", // Always start with default layout
                layout: keyboardLayouts[currentLanguage],
                display: {
                    '{next}': '🌐',
                    '{enter}': 'Send',
                    '{shift}': 'Shift',
                    '{space}': ' ',
                    '{backspace}': '⌫',
                    '{hide}': 'Done'
                }
            });
        }
        
        function onKeyboardChange(input) {
            messageInput.value = input;
        }

        function onKeyPress(button) {
            if (button === "{shift}" || button === "{lock}") handleShift();
            if (button === "{enter}") sendMessage();
            if (button === "{next}") handleNextLanguage();
            if (button === "{hide}") hideKeyboard();
        }

        function handleShift() {
            const currentLayout = keyboard.options.layoutName;
            const newLayoutName = currentLayout === "default" ? "shift" : "default";
            keyboard.setOptions({
                layoutName: newLayoutName
            });
        }

        function handleNextLanguage() {
            const currentIndex = languageCycle.indexOf(currentLanguage);
            const nextIndex = (currentIndex + 1) % languageCycle.length;
            const nextLang = languageCycle[nextIndex];
            setLanguage(nextLang);
        }

        function showKeyboard() {
            keyboardContainer.classList.add('visible');
            chatArea.classList.add('chat-area-with-keyboard');
            keyboardBtn.classList.add('active');
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideKeyboard() {
            keyboardContainer.classList.remove('visible');
            chatArea.classList.remove('chat-area-with-keyboard');
            keyboardBtn.classList.remove('active');
        }

        keyboardBtn.addEventListener('click', () => {
            const isVisible = keyboardContainer.classList.contains('visible');
            if (isVisible) {
                hideKeyboard();
            } else {
                showKeyboard();
            }
        });

    </script>
</body>
</html>



